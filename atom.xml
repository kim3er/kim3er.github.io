<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Adventures in brine]]></title>
  <link href="http://rich.k3r.me/atom.xml" rel="self"/>
  <link href="http://rich.k3r.me/"/>
  <updated>2015-04-21T23:09:36+01:00</updated>
  <id>http://rich.k3r.me/</id>
  <author>
    <name><![CDATA[Richard Kimber]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[There Is No Spoon]]></title>
    <link href="http://rich.k3r.me/blog/2015/04/21/there-is-no-spoon/"/>
    <updated>2015-04-21T22:25:32+01:00</updated>
    <id>http://rich.k3r.me/blog/2015/04/21/there-is-no-spoon</id>
    <content type="html"><![CDATA[<p><em><strong>TL;DR:</strong> I&rsquo;m using a scene from the movie, The Matrix, as a metaphor for dealing with self doubt. Nifty.</em></p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/uAXtO5dMqEI" frameborder="0" allowfullscreen></iframe>




<!-- More -->


<h2>The epiphany</h2>

<p>Watching &lsquo;the spoon&rsquo; scene from The Matrix for the first time, it was one of those zen moments when the universe gets a little bit clearer. I suspect, if there is a true interpretation to the scene, mine is a little off. Essentially though, I believe that the spoon simultaneously represents a goal and the inability to achieve that goal. The spoon is there and you want to move it, but you can&rsquo;t, because you can&rsquo;t perceive it as anything more malleable than a spoon. The truth is, &ldquo;there is no spoon&rdquo;. There is only your perception of a spoon. So for the spoon to bend, it is you who must bend.</p>

<p>The epiphany I had, was not that I can now bend spoons. I can&rsquo;t, at least I don&rsquo;t think I can. It&rsquo;s not say I&rsquo;m not suspicious sometimes, but as far as I know, I&rsquo;m not in The Matrix. I really like steak though, so I would I want to leave if I was? My epiphany, was that I see the spoon everyday.</p>

<p>I&rsquo;ve been tempted to prattle on for the rest of this post about how I see the spoon in every facet of my life, which is true. But it was looking very much like an incoherent ramble. So I&rsquo;ve tried to focus on how &lsquo;the spoon&rsquo; affects my work as a software developer, and what I do to see past the spoon. I will attempt to drop references to &lsquo;the spoon&rsquo;, at the first available opportunity.</p>

<h2>The stages of the spoon</h2>

<p>In my work, when I am working through a new project, I typically go through these stages:</p>

<ol>
<li><strong><em>Excitement</em></strong>, as I enthuse over the possibilities for implementation. &lt;&ndash; The project is the spoon, the possibilities are my desire to bend the spoon.</li>
<li><strong><em>Worry</em></strong>, that I&rsquo;ve gotten ahead of myself, promised the world, only to deliver Keighley (sorry Keighley, it&rsquo;s not that you&rsquo;re bad, you&rsquo;re just not to the world). &lt;&ndash; This is my perception of the spoon as an unbending instrument of breakfast.</li>
<li><strong><em>Focus</em></strong>, as I get over myself and get the work done. &lt;&ndash; This is me going all kung-fu on the spoon&rsquo;s ass (bottom, not donkey).</li>
<li><strong><em>Mission accomplished</em></strong>. &lt;&ndash; Spoon, moved.</li>
</ol>


<p>I certainly hope for step 4, and I hope steps 1-3 aren&rsquo;t a million miles away from most other people. But how does one see through the spoon? On some projects by the time I start step 3, I&rsquo;ve all but smashed my self confidence to pieces. Step 3 can sometimes be driven by fear that you might not live up to your own expectations and pigheadedness that you won&rsquo;t allow the project to fail!</p>

<h2>Getting through it</h2>

<p>So how do I get through step 2? These are the things I do, that keep me going through bouts of insecurity.</p>

<h3>Scare yourself</h3>

<p>So it turns out that Mary Schmich, <a href="http://quoteinvestigator.com/2013/08/09/scare/">not Eleanor Roosevelt</a> said &ldquo;Do One Thing Every Day That Scares You&rdquo;. I never sit still when it comes to development. The moment I feel too comfortable, I become restless. I push myself to learn something new in every project I do. I&rsquo;m not particularly self motivated when it comes to personal projects, so I&rsquo;ve also always used work as my driver.</p>

<p>I went for a job interview once, sonn after I&rsquo;d switched from VB to VB.NET. The Interviewer asked why I&rsquo;d chosen VB.NET instead of C#. I explained that VB.NET seemed like the more obvious choice, because of it&rsquo;s simularities with what I already knew. He felt that it was all the more reason to dive into C#. I didn&rsquo;t get the job, but I did learn C#.</p>

<p>Visual Studio suddenly became incredible, around 2003. I used to joke that I could write a complete application without ever finishing a word. &lsquo;da, da, tab, da, da, tab&rsquo;. VS was great and I loved working in it, but I was becoming increasingly scared of the outdoors. I started programming Classic ASP in Notepad, but now I wasn&rsquo;t sure it was even possible to compile my applications outside of VS. I was spoilt, too used to using Enterprise editions, to ever be happy in the free version. &ldquo;I can&rsquo;t use Express, it doesn&rsquo;t support Solutions!&rdquo;</p>

<p>My reaction, was to start messing around with Ruby, but in a text editor, rather than a full blown IDE. A very liberating experience. I&rsquo;ve not looked back, it&rsquo;s probably been about 5 years since I worked with .NET in earnest.</p>

<h3>Own it</h3>

<p>There really isn&rsquo;t anything more important to the resolution of a task, than feeling like you own it. Without ownership, you make yourself powerless. The spoon will never bend, unless you own that mother hubbard.</p>

<p>The best example of ownership I can give you, is a plugin. Let&rsquo;s say, you&rsquo;ve been asked to put an image slider into a website. You could build it from scratch, but client expectations outweigh their budget. Anyway, there really is no point reinventing the wheel; it feels like I come across a new slider plugin everyday. You implement the plugin. It&rsquo;s really cool, doing all this neat stuff, as if by magic. The client is really happy, but it&rsquo;s not working so great on IE &lsquo;whatever&rsquo; under some obscure scenario, so you need to change it.</p>

<p>It&rsquo;s magic though, it&rsquo;s doing this thing here, and this thing there. It&rsquo;s crazy black magic and you&rsquo;re a fraud for even sticking it in the site, because you didn&rsquo;t create the magic, you pasted it in and hoped for the best. If you&rsquo;re thinking like this, it&rsquo;s safe to say, you&rsquo;re not really &lsquo;owning it&rsquo;.</p>

<p>It&rsquo;s not magic, it&rsquo;s JavaScript, probably a jQuery plugin. You could swap out that plugin, that is definitely an option. Or, checkout the documentation to see if there is a setting you can tweak. But you know, sometimes you&rsquo;ve just got to crack open the code and see what&rsquo;s going on. The investigation may just throw up some assumption, made by the plugin, that you can cater for in the outer project. But maybe you&rsquo;ll find yourself a bug that you can fix or report. Whether you&rsquo;re logging a bug, creating a pull request, or forking the whole plugin, you&rsquo;re owning it.</p>

<h2>In summary</h2>

<p>I&rsquo;m not really comfortable with these sorts of posts, they tend to sound a bit preachy. It is something I feel quite strongly about though. Ultimately in development, as in life, the only obstacle is the one you create yourself. Change your perception of the task, take control of it and push yourself to take a different approach. There is no spoon.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Consuming ES6 Modules in NPM Packages]]></title>
    <link href="http://rich.k3r.me/blog/2015/04/12/consuming-es6-modules-in-npm-packages/"/>
    <updated>2015-04-12T14:06:12+01:00</updated>
    <id>http://rich.k3r.me/blog/2015/04/12/consuming-es6-modules-in-npm-packages</id>
    <content type="html"><![CDATA[<p>I&rsquo;m going to have to start coming up with more interesting title for my posts. My eyes are watering at the thought of &lsquo;Consuming ES6 modules in NPM packages&rsquo;. Maybe something more exciting, like &lsquo;Munching on the nuggets of next gen wonderment&rsquo;. I&rsquo;ll work on it.</p>

<p>In this post I&rsquo;m going to describe how you can make use of <a href="https://babeljs.io/">Babel&rsquo;s</a> support for <a href="https://babeljs.io/docs/learn-es6/#modules">ES6 modules</a>, and how you might consume them as <a href="https://www.npmjs.com/">NPM</a> packages. It&rsquo;s pretty neato stuff and makes for very clean code. Read on!</p>

<!-- more -->


<p><em><strong>TL;DR:</strong> Scroll down to the <a href="http://www.starwars.com/">Star Wars</a> reference for the actual tutorial.</em></p>

<p><em><strong>NOTE:</strong> This tutorial has two <a href="https://github.com/">Github</a> repos, <a href="https://github.com/kim3er/example-es6-module">this one</a> and <a href="https://github.com/kim3er/example-module-consumer">this one</a>.</em></p>

<p>Modules have existed in JS space for a while now. I&rsquo;ve dabbled in the past, because I&rsquo;m a big fan of results, I mean who wouldn&rsquo;t be?</p>

<ul>
<li>Keeps junk out of the global scope</li>
<li>Only load what you need</li>
<li>Inferred order of compilation</li>
</ul>


<p>I&rsquo;m just going to pick up on that last point for a moment. While I dabbled, I never really embraced modules as part of a longer term strategy. My reluctance was due to inherent ugliness of implementation, with anything but Node&rsquo;s <code>require</code> and <code>exports</code> syntax. The ugliness is there to make these great ideas work in the browser.</p>

<p>Using the fantastic <a href="https://jquery.com/">jQuery</a> as an example, stuff like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">module</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// For CommonJS and CommonJS-like environments where a proper `window`</span>
</span><span class='line'>  <span class="c1">// is present, execute the factory and get jQuery.</span>
</span><span class='line'>  <span class="c1">// For environments that do not have a `window` with a `document`</span>
</span><span class='line'>  <span class="c1">// (such as Node.js), expose a factory as module.exports.</span>
</span><span class='line'>  <span class="c1">// This accentuates the need for the creation of a real `window`.</span>
</span><span class='line'>  <span class="c1">// e.g. var jQuery = require(&quot;jquery&quot;)(window);</span>
</span><span class='line'>  <span class="c1">// See ticket #14549 for more info.</span>
</span><span class='line'>  <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">global</span><span class="p">.</span><span class="nb">document</span> <span class="o">?</span>
</span><span class='line'>      <span class="nx">factory</span><span class="p">(</span> <span class="nx">global</span><span class="p">,</span> <span class="kc">true</span> <span class="p">)</span> <span class="o">:</span>
</span><span class='line'>      <span class="kd">function</span><span class="p">(</span> <span class="nx">w</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">w</span><span class="p">.</span><span class="nb">document</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span> <span class="s2">&quot;jQuery requires a window with a document&quot;</span> <span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="k">return</span> <span class="nx">factory</span><span class="p">(</span> <span class="nx">w</span> <span class="p">);</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">factory</span><span class="p">(</span> <span class="nx">global</span> <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// Register as a named AMD module, since jQuery can be concatenated with other</span>
</span><span class='line'><span class="c1">// files that may use define, but not via a proper concatenation script that</span>
</span><span class='line'><span class="c1">// understands anonymous AMD modules. A named AMD is safest and most robust</span>
</span><span class='line'><span class="c1">// way to register. Lowercase jquery is used because AMD module names are</span>
</span><span class='line'><span class="c1">// derived from file names, and jQuery is normally delivered in a lowercase</span>
</span><span class='line'><span class="c1">// file name. Do this after creating the global so that if an AMD module wants</span>
</span><span class='line'><span class="c1">// to call noConflict to hide this version of jQuery, it will work.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Note that for maximum portability, libraries that are not jQuery should</span>
</span><span class='line'><span class="c1">// declare themselves as anonymous modules, and avoid setting a global if an</span>
</span><span class='line'><span class="c1">// AMD loader is present. jQuery is a special case. For more information, see</span>
</span><span class='line'><span class="c1">// https://github.com/jrburke/requirejs/wiki/Updating-existing-libraries#wiki-anon</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">define</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">define</span><span class="p">.</span><span class="nx">amd</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">define</span><span class="p">(</span> <span class="s2">&quot;jquery&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">jQuery</span><span class="p">;</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// Expose jQuery and $ identifiers, even in AMD</span>
</span><span class='line'><span class="c1">// (#7102#comment:10, https://github.com/jquery/jquery/pull/557)</span>
</span><span class='line'><span class="c1">// and CommonJS for browser emulators (#13566)</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">noGlobal</span> <span class="o">===</span> <span class="nx">strundefined</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">$</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I get why it&rsquo;s all there, and I appreciate the efforts teams like jQuery put into compatibility with all of these different systems. I have benefitted from those efforts on many occasions. I bet it&rsquo;s a pain in the backside to maintain, it&rsquo;s very clever, but also, U-G-L-Y.</p>

<h3>Flashback (wavy lines)</h3>

<p>I was drawn back into the fold, as the result of a recent ES6 based project I&rsquo;ve been working on. I was gorging on the beautiful ES6 class syntax, doing a fine job of controlling compilation through the use of sub folders.</p>

<p>As an example, the classes in directories &lsquo;controller&rsquo; and &lsquo;model&rsquo;, inherit from directory &lsquo;base&rsquo;. Classes in &lsquo;controller&rsquo; can reference classes in &lsquo;model&rsquo;, but not the other way around.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root
</span><span class='line'>  base            &lt;-- Compile first
</span><span class='line'>  controller      &lt;-- Compile third
</span><span class='line'>  model           &lt;-- Compile second
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>base/base_class.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">class</span> <span class="nx">BaseClass</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">parent</span><span class="p">()</span>  <span class="p">{</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;something interesting&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>controller/app_controller.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">class</span> <span class="nx">AppController</span> <span class="kr">extends</span> <span class="nx">BaseClass</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">action</span><span class="p">()</span>  <span class="p">{</span>
</span><span class='line'>      <span class="kd">let</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserModel</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;I\&#39;m an action&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>model/user_model.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">class</span> <span class="nx">UserModel</span> <span class="kr">extends</span> <span class="nx">BaseClass</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;I\&#39;m a model&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This all worked great, better than great, I was king of the world. Until I needed to create <code>BaseController</code>, that extends <code>BaseClass</code> and is extended by <code>AppController</code>.</p>

<figure class='code'><figcaption><span>controller/base_controller.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">class</span> <span class="nx">BaseController</span> <span class="kr">extends</span> <span class="nx">BaseClass</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">defaultAction</span><span class="p">()</span>  <span class="p">{</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;I\&#39;m a default action&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>controller/app_controller.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">class</span> <span class="nx">AppController</span> <span class="kr">extends</span> <span class="nx">BaseController</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">action</span><span class="p">()</span>  <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">defaultAction</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Due to the dreaded alphabet, <code>AppController</code> compiles before <code>BaseController</code>. Arrrgh. Why world, would you treat me this way?!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>controller
</span><span class='line'>  app_controller.js       &lt;-- Attempts to compile first, but BaseController doesn<span class="err">&#39;</span>t exist yet
</span><span class='line'>  base_controller.js      &lt;-- Waits patiently
</span></code></pre></td></tr></table></div></figure>


<p>Don&rsquo;t tell anyone, but my initial fix was to:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>controller
</span><span class='line'>  0.base_controller.js    &lt;-- Compiles first
</span><span class='line'>  app_controller.js       &lt;-- Compiles second
</span></code></pre></td></tr></table></div></figure>


<p>I kidded myself for a while that this was a valid design decision, until maybe my third or forth &lsquo;zero dot&rsquo; file. I needed a better way of controlling the order of compilation; it also felt like those base classes could be reused.</p>

<h2>And so, it begins. Destroy them, destroy them all.</h2>

<p>We&rsquo;re going to create two projects; the <a href="https://github.com/kim3er/example-es6-module">module</a> and the <a href="https://github.com/kim3er/example-module-consumer">consumer</a>.</p>

<h3>The module</h3>

<p>The module package will be written in ES6 JavaScript, but will need to be transpilied to ES5, for compatibility. So the ugliness is still there, just hidden. We&rsquo;ll use <a href="http://gulpjs.com/">Gulp</a> and Babel for the build.</p>

<h4>The setup</h4>

<p>I&rsquo;ve created a directory called &lsquo;blog&rsquo;, in here I&rsquo;m writing the following, in terminal:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir es6-module
</span><span class='line'><span class="nb">cd </span>es6-module
</span><span class='line'>npm init                      &lt;-- Just enter through the defaults
</span><span class='line'>mkdir src
</span><span class='line'>touch gulpfile.js .gitignore
</span></code></pre></td></tr></table></div></figure>


<p>Your project should look like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>es6-module
</span><span class='line'>  src                 &lt;-- This is where we<span class="se">\&#39;</span>re going to put our ES6
</span><span class='line'>  .gitignore          &lt;-- We<span class="se">\&#39;</span>ll need to ignore <span class="se">\&#39;</span>node-modules<span class="se">\&#39;</span>, when this goes to GIT
</span><span class='line'>  gulpfile.js         &lt;-- Gulp build file
</span><span class='line'>  package.json        &lt;-- This was created when you typed in <span class="se">\&#39;</span>npm init<span class="se">\&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Make &lsquo;.gitignore&rsquo; look this:</p>

<figure class='code'><figcaption><span>.gitignore</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>node_modules
</span></code></pre></td></tr></table></div></figure>


<p>Change the <code>main</code> option in &lsquo;package.json&rsquo; to read &lsquo;./lib/index.js&rsquo;. A &lsquo;lib&rsquo; directory will be created as part of the build process, which will contain our ES5 code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="err">....</span>
</span><span class='line'>  <span class="nt">&quot;main&quot;</span><span class="p">:</span> <span class="s2">&quot;./lib/index.js&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="err">....</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>main</code> is the entry point to our package. In a consumer, if you were to <code>require('es6-module')</code>, you&rsquo;ll get the exports from the <code>main</code> file.</p>

<h4>The build script</h4>

<p>We need a build script in our &lsquo;gulpfile.js&rsquo;.</p>

<figure class='code'><figcaption><span>gulpfile.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">del</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;del&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">babel</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-babel&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">SRC_PATH</span> <span class="o">=</span> <span class="s1">&#39;./src&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">LIB_PATH</span> <span class="o">=</span> <span class="s1">&#39;./lib&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">del</span><span class="p">([</span> <span class="nx">LIB_PATH</span> <span class="o">+</span> <span class="s1">&#39;/*&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">cb</span><span class="p">();</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;clear&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">([</span> <span class="nx">SRC_PATH</span> <span class="o">+</span> <span class="s1">&#39;/**/*.js&#39;</span> <span class="p">])</span>
</span><span class='line'>              <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">babel</span><span class="p">({</span> <span class="nx">blacklist</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;useStrict&#39;</span> <span class="p">]</span> <span class="p">}))</span>
</span><span class='line'>              <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">LIB_PATH</span><span class="p">));</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">gulp</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>The script has three dependancies:</p>

<ol>
<li>Gulp - The script runner. Like <a href="http://gruntjs.com/">Grunt</a>, but code first.</li>
<li><a href="https://www.npmjs.com/package/del">Del</a> - A little package for deleting stuff.</li>
<li>Babel - ES6 transpiler. Reinvigorated my already deeply unnatural love of JavaScript. Hallelujah.</li>
</ol>


<p>Install the dependancies like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>npm install -g gulp babel
</span><span class='line'>npm install --save-dev gulp del gulp-babel
</span></code></pre></td></tr></table></div></figure>


<p>I think the <code>clear</code> task is self explanatory, so lets talk about <code>build</code>. Typically in a build script, it&rsquo;s tempting to concatenate, but our package is going to benefit from keeping the code in separate files. By keeping the code in separate files, modular, we&rsquo;ll be implementing JavaScript module benefit #2 &lsquo;Only load what you need&rsquo;.</p>

<p>The code itself is transpiled through Babel, to create the ES6 code in &lsquo;lib&rsquo;. I&rsquo;ve blacklisted &lsquo;useStrict&rsquo;. I do this by default, because <code>"use strict"</code> can stop execution in iOS UIWebViews, specifically when using <a href="http://cordova.apache.org/">Cordova</a>.</p>

<h4>The code</h4>

<p>In the src directory, create the following files:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>src
</span><span class='line'>  clever_class.js &lt;-- An example module
</span><span class='line'>  index.js        &lt;-- Our main file
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>src/clever_class.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">export</span> <span class="kr">class</span> <span class="nx">CleverClass</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;I\&#39;m a clever class&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>src/index.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">export</span> <span class="o">*</span> <span class="nx">from</span> <span class="s1">&#39;./clever_class&#39;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>I think you can already see how useful our new package is going to be.</em></p>

<p><code>CleverClass</code> is pretty unexceptional, except for the addition of <code>export</code> before the <code>class</code> declaration. <code>export</code> tells Babel that we want to reference <code>CleverClass</code> as module.</p>

<p>The code in &lsquo;index.js&rsquo; is really interesting. We&rsquo;re literally creating an index to all modules in our package, that we want made public. <code>export * from</code> (not <code>import</code>), re-exports <code>CleverClass</code> as part of &lsquo;index.js&rsquo;.</p>

<p>Think about the implications here. You can have twenty different classes in this directory, all extending each other in different and exciting ways. From &lsquo;index.js&rsquo;, you choose which of those classes make it to your public API. <code>CleverClass</code> may inherit from a class called <code>BaseClass</code>, but only <code>CleverClass</code> is accessible, even though <code>CleverClass</code> still benefits from the existence of <code>BaseClass</code>.</p>

<p><em>At this point, you&rsquo;re starting to feel like Skeletor, just before he was robbed of the powers of Grey Skull.</em></p>

<p>Okay, build the mutha:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>gulp build
</span></code></pre></td></tr></table></div></figure>


<p>Any errors? No, great. You should now have a &lsquo;lib&rsquo; directory that mirrors the structure of &lsquo;src&rsquo;, just with ES5 code, instead of ES6.</p>

<p><em><strong>NOTE:</strong> This feels a bit &lsquo;fly-by the seat of your pants&rsquo; coding. Usually I&rsquo;d have a test suite in the project, to ensure that we&rsquo;re all rocking in the right direction. However, we&rsquo;re about to build a consumer for exactly that, and for the purposes of this tutorial I wanted to keep concerns clean and avoid duplication. You dig?</em></p>

<h3>The consumer</h3>

<p>The purpose of this tutorial is to demonstrate how you can consume ES6 modules, contained within an NPM package. To do this, we need a separate project, from which to consume the package; this is that project.</p>

<h4>The setup</h4>

<p>From the blog directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir module-consumer
</span><span class='line'><span class="nb">cd </span>module-consumer
</span><span class='line'>npm init                      &lt;-- Just enter through the defaults
</span><span class='line'>mkdir app
</span><span class='line'>touch gulpfile.js .gitignore
</span></code></pre></td></tr></table></div></figure>


<p>Here is our &lsquo;.gitignore&rsquo;:</p>

<figure class='code'><figcaption><span>.gitignore</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>.web
</span><span class='line'>node_modules
</span></code></pre></td></tr></table></div></figure>


<p>Here is our directory structure:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>module-consumer
</span><span class='line'>  app                 &lt;-- This is where we<span class="se">\&#39;</span>re going to put our <span class="nb">test </span>app
</span><span class='line'>  .gitignore          &lt;-- We<span class="err">&#39;</span>ll need to ignore <span class="se">\&#39;</span>node-modules<span class="se">\&#39;</span>, when this goes to GIT
</span><span class='line'>  gulpfile.js         &lt;-- Gulp build file
</span><span class='line'>  package.json        &lt;-- This was created when you typed in <span class="se">\&#39;</span>npm init<span class="se">\&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>The build script</h4>

<p>Our test app is going to be a very simple website, so we&rsquo;re going to need a web server, in this case <a href="https://github.com/senchalabs/connect">Connect</a>. Because we&rsquo;re using a website as our testbed, we need to a way to consume the NPM package in a way that the browser understands; for this, we will use <a href="http://browserify.org/">Browserify</a>.</p>

<figure class='code'><figcaption><span>gulpfile.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">connect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-connect&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">del</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;del&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">watch</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-watch&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">runSequence</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;run-sequence&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">babelify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;babelify&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">browserify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;browserify&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">source</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;vinyl-source-stream&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">APP_PATH</span> <span class="o">=</span> <span class="s1">&#39;./app&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">WEB_PATH</span> <span class="o">=</span> <span class="s1">&#39;./.web&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">del</span><span class="p">([</span> <span class="nx">WEB_PATH</span> <span class="o">+</span> <span class="s1">&#39;/*&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">cb</span><span class="p">();</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;js&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">browserify</span><span class="p">({</span>
</span><span class='line'>                  <span class="nx">entries</span><span class="o">:</span> <span class="nx">APP_PATH</span> <span class="o">+</span> <span class="s1">&#39;/app.js&#39;</span><span class="p">,</span>
</span><span class='line'>                  <span class="nx">debug</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>              <span class="p">})</span>
</span><span class='line'>              <span class="p">.</span><span class="nx">transform</span><span class="p">(</span><span class="nx">babelify</span><span class="p">)</span>
</span><span class='line'>              <span class="p">.</span><span class="nx">bundle</span><span class="p">()</span>
</span><span class='line'>              <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">source</span><span class="p">(</span><span class="s1">&#39;app.js&#39;</span><span class="p">))</span>
</span><span class='line'>              <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">WEB_PATH</span><span class="p">));</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">([</span> <span class="nx">APP_PATH</span> <span class="o">+</span> <span class="s1">&#39;/index.html&#39;</span> <span class="p">])</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">WEB_PATH</span><span class="p">));</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">connect</span><span class="p">.</span><span class="nx">server</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">root</span><span class="o">:</span> <span class="nx">WEB_PATH</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">livereload</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">cb</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;livereload&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span> <span class="nx">WEB_PATH</span> <span class="o">+</span> <span class="s1">&#39;/**/*&#39;</span> <span class="p">)</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">connect</span><span class="p">.</span><span class="nx">reload</span><span class="p">());</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;serve&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;clear&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">runSequence</span><span class="p">(</span>
</span><span class='line'>      <span class="p">[</span> <span class="s1">&#39;js&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span> <span class="p">],</span>
</span><span class='line'>      <span class="s1">&#39;connect&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>          
</span><span class='line'>          <span class="nx">watch</span><span class="p">([</span> <span class="nx">APP_PATH</span> <span class="o">+</span> <span class="s1">&#39;/app.js&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="s1">&#39;js&#39;</span><span class="p">);</span> <span class="p">});</span>
</span><span class='line'>          <span class="nx">watch</span><span class="p">([</span> <span class="nx">APP_PATH</span> <span class="o">+</span> <span class="s1">&#39;/index.html&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span> <span class="p">});</span>
</span><span class='line'>          <span class="nx">watch</span><span class="p">([</span> <span class="nx">WEB_PATH</span> <span class="o">+</span> <span class="s1">&#39;/**/*&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="s1">&#39;livereload&#39;</span><span class="p">);</span> <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>          <span class="nx">cb</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>The script has these dependancies:</p>

<ol>
<li>Gulp</li>
<li>Gulp Connect - Our web server.</li>
<li>Del</li>
<li><a href="https://www.npmjs.com/package/gulp-watch">Gulp Watch</a> - Kicks off Gulp tasks, when a file changes.</li>
<li><a href="https://www.npmjs.com/package/run-sequence">Run Sequence</a> - Asynchronous task management. <a href="http://rich.k3r.me/blog/2015/03/23/in-the-name-of-gulp/">Read my blog</a>.</li>
<li><a href="https://github.com/babel/babelify">Babelify</a> - Babel transformer for Browserify.</li>
<li>Browserify - Makes Node&rsquo;s <code>require</code> work in the browser.</li>
<li><a href="https://www.npmjs.com/package/vinyl-source-stream">Vinyl Source Stream</a> - Makes Browserify work with Gulp.</li>
</ol>


<p>Install them:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>npm install --save-dev gulp gulp-connect del gulp-watch run-sequence babelify browserify vinyl-source-stream
</span></code></pre></td></tr></table></div></figure>


<p>Here&rsquo;s a quick rundown of the tasks in this script:</p>

<h5>js</h5>

<p>Transpiles and concatenates the contents of &lsquo;app/app.js&rsquo; (not created yet), using Browserify. Browserify follows every <code>require</code>, creates a virtual tree, then bundles all the code in one file.</p>

<p><em>I mean, wow, just wow.</em></p>

<p>We&rsquo;re not using the <code>require</code> syntax though, so we need Babelify. Babelify transforms/transpiles the ES6 syntax to ES5, for Browserify to understand.</p>

<p>The result of which is outputted to our temporary web directory (&lsquo;.web&rsquo;, which doesn&rsquo;t exist yet).</p>

<h5>index</h5>

<p>Moves &lsquo;app/index.html&rsquo; to &lsquo;.web/index.html&rsquo;. You don&rsquo;t want to be working directly in &lsquo;.web&rsquo;.</p>

<h5>connect</h5>

<p>Uses Connect to start a web server, with <a href="http://livereload.com/">Live Reload</a>.</p>

<h5>livereload</h5>

<p>Reacts to file changes. Live Reload reloads your browser programmatically. It&rsquo;s pure magic.</p>

<h5>serve</h5>

<p>This is what we type into terminal. It&rsquo;s a &lsquo;stitch everything together task&rsquo;. We use Run Sequence to run our two compilation tasks, <code>js</code> and <code>index</code>, before kicking off the web server task <code>connect</code>. Finally, we set off the file watchers, that react accordingly to file changes.</p>

<h4>The code</h4>

<p>I&rsquo;m going to start by boilerplating &lsquo;index.html&rsquo; in the &lsquo;app&rsquo; directory; the sole point of this file is to load &lsquo;app.js&rsquo;.</p>

<figure class='code'><figcaption><span>app/index.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;title&gt;&lt;/title&gt;</span>
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;./app.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here&rsquo;s &lsquo;app.js&rsquo;.</p>

<figure class='code'><figcaption><span>app/app.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// Example 1: Namespace</span>
</span><span class='line'><span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">es6</span> <span class="nx">from</span> <span class="s1">&#39;es6-module&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">new</span> <span class="nx">es6</span><span class="p">.</span><span class="nx">CleverClass</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// Example 2: Choose exports</span>
</span><span class='line'><span class="c1">// import { CleverClass } from &#39;es6-module&#39;;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// new CleverClass();</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// Example 3: Target individual files</span>
</span><span class='line'><span class="c1">// import { CleverClass } from &#39;es6-module/lib/clever_class&#39;;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// new CleverClass();</span>
</span></code></pre></td></tr></table></div></figure>


<p>&lsquo;app.js&rsquo; contains three examples of how can access &lsquo;CleverClass&rsquo; from our first project&hellip; Aww crap, hang on a minute, we&rsquo;ve not actually referenced our &lsquo;es6-module&rsquo; package!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>npm install --save-dev ../es6-module
</span></code></pre></td></tr></table></div></figure>


<p><em><strong>NOTE:</strong> NPM allows you to install local packages, that&rsquo;s what going on in the code above.</em></p>

<p>What was I saying? Right, three examples. They should all have the same result, but show the flexibility was the ES6 way of doing modules:</p>

<ol>
<li>Namespace - Using <code>as</code>, you can wrap your imports in a namespace. Very tidy.</li>
<li>Be selective - You may only want to use one or two classes, list them in curly brackets!</li>
<li>Don&rsquo;t pull in the whole library - Prepare to have your mind blown. &lsquo;Boom&rsquo;. You can reference individual modules within the package. Don&rsquo;t say a word, it&rsquo;s alright, I know. #shhh</li>
</ol>


<p>Run the server and breath in the sweet, sweet smell of success.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>gulp serve
</span></code></pre></td></tr></table></div></figure>


<p>I accept the payoff is a little underwhelming. If all is well, when you open you dev tool in a browser, pointed at <a href="http://localhost:8080">http://localhost:8080</a>, you should see:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>I&#39;m a clever class
</span></code></pre></td></tr></table></div></figure>


<h3>The conclusion</h3>

<p>That&rsquo;s not the point. The point is, &ldquo;I&rsquo;m a clever class&rdquo; was written in module in one package, and accessed from a script in another. All the code was written in ES6, and only the files needed, were accessed in the test site.</p>

<p>We&rsquo;ve gained:</p>

<ol>
<li>A modular build.</li>
<li>A reusable library.</li>
<li>Only compile what you use.</li>
<li>Future proofing, with ES6 compatible base code.</li>
</ol>


<p>We. Are. Awesome.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Controlling Cordova From Gulp]]></title>
    <link href="http://rich.k3r.me/blog/2015/04/02/controlling-cordova-from-gulp/"/>
    <updated>2015-04-02T22:39:27+01:00</updated>
    <id>http://rich.k3r.me/blog/2015/04/02/controlling-cordova-from-gulp</id>
    <content type="html"><![CDATA[<p>It&rsquo;s a story as old as time. Girl meets boy, boy has an annoying two step build process, spread across two directories. Of course I&rsquo;m talking about having an awesome <a href="http://gulpjs.com/">Gulp</a> workflow, with a Cordova project clumsily tacked on the side. Well, no more, now you can integrate <a href="http://cordova.apache.org/">Cordova</a>! into Gulp! Yay!</p>

<!-- more -->


<p><em><strong>NOTE:</strong> You see the code over at <a href="https://github.com/kim3er/cordova-gulp">Github</a>.</em></p>

<p>Let&rsquo;s discuss the problem first. Until recently, Gulp and Cordova were two separate Node based, command line powered worlds to me, with seemingly nothing in common. In the given scenario, I&rsquo;d typically have a two directory structure:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>app              &lt;-- Source files for the project
</span><span class='line'>cordova           &lt;-- Cordova root directory
</span><span class='line'>  - www       &lt;-- Cordova app directory
</span><span class='line'>gulpfile.js</span></code></pre></td></tr></table></div></figure>


<p>Gulp would take care of transpiling the code in the <code>app</code> directory and transferring the spoils to <code>cordova/www</code>. Cordova is then responsible for building the Cordova project and delivering the app to an emulator.  Something like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>gulp
</span><span class='line'><span class="nb">cd</span> ./cordova
</span><span class='line'>cordova emulate
</span><span class='line'><span class="nb">cd</span> ../
</span></code></pre></td></tr></table></div></figure>


<p>Before switching to Gulp, I used to use Middleman for a lot of the transpiling tasks, where I&rsquo;d maintain a number of bash scripts to create the illusion of cohesion. It didn&rsquo;t feel right when I switched to Gulp though. There must be some similarity between these disparate Node based, command line tools. What was I missing?</p>

<p>You know what I realised? That Gulp is based on Node and so is Cordova; so I can probably access Cordova directly from within my Gulp task. It&rsquo;s never going to be that easy, is it?</p>

<p>Well, it&rsquo;ll be a disappointment if it wasn&rsquo;t that easy. So long story short, it almost is. To demonstrate, I&rsquo;m going to cook up a quick project, to demonstrate the integration:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>npm init
</span><span class='line'>touch gulpfile.js
</span><span class='line'>npm install -g cordova gulp ios-deploy
</span><span class='line'>npm install --save-dev gulp cordova-lib del
</span><span class='line'>cordova create ./cordova me.k3r.cordgulp CordovaGulp
</span></code></pre></td></tr></table></div></figure>


<p>Accept all the defaults on <code>npm install</code>, if you&rsquo;re not sure how to answer. All it does is create your <code>package.json</code> and settings can be easily changed at any time.</p>

<p>The <code>-g</code> means install globally, and the <code>--save-dev</code> will save the packages as development dependancies within the <code>package.json</code>. Have a look, you&rsquo;ll see what I mean.</p>

<p><a href="https://github.com/phonegap/ios-deploy">ios-deploy</a> is neat if you&rsquo;re on a Mac and want to deploy from script or command line to iOS.</p>

<p>The last line scaffolds a basic Cordova project.</p>

<p>Paste in the following to your newly created <code>gulpfile.js</code>, but don&rsquo;t run anything yet!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">del</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;del&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">cordova</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cordova-lib&#39;</span><span class="p">).</span><span class="nx">cordova</span><span class="p">.</span><span class="nx">raw</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">APP_PATH</span> <span class="o">=</span> <span class="s1">&#39;./app&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">CORDOVA_PATH</span> <span class="o">=</span> <span class="s1">&#39;./cordova/www&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;del-cordova&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">del</span><span class="p">([</span> <span class="nx">CORDOVA_PATH</span> <span class="o">+</span> <span class="s1">&#39;/*&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">cb</span><span class="p">();</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;compile&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;del-cordova&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">([</span> <span class="nx">APP_PATH</span> <span class="o">+</span> <span class="s1">&#39;/**/*&#39;</span> <span class="p">])</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">CORDOVA_PATH</span><span class="p">));</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;compile&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">process</span><span class="p">.</span><span class="nx">chdir</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/cordova&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">cordova</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">build</span><span class="p">()</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">process</span><span class="p">.</span><span class="nx">chdir</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">cb</span><span class="p">();</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;emulate&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;compile&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">process</span><span class="p">.</span><span class="nx">chdir</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/cordova&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">cordova</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">run</span><span class="p">({</span> <span class="nx">platforms</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;ios&#39;</span> <span class="p">]</span> <span class="p">})</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">process</span><span class="p">.</span><span class="nx">chdir</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">cb</span><span class="p">();</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you ran anything at the point, you&rsquo;d replace the default Cordova <code>www</code> directory with that stark emptiness of your nonexistent <code>app</code> directory. Remedy that with the following, which moves the contents of <code>cordova/www</code> to <code>app</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mv ./cordova/www ./app
</span></code></pre></td></tr></table></div></figure>


<p>You now have the almost complete example. If you type in <code>gulp compile</code>, <code>cordova/www</code> will be recreated with the contents of <code>app</code>. Nothing else is going on here at the moment, but think of the possibilities.</p>

<p>We haven&rsquo;t quite finished yet. Type in the following, to add iOS and/or Android as platforms to your new project.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd </span>cordova
</span><span class='line'>cordova platform add ios
</span><span class='line'><span class="nb">cd</span> ../
</span></code></pre></td></tr></table></div></figure>


<p>While you&rsquo;re in the <code>cordova</code> directory, you could have also run <code>cordova build</code> or <code>cordova emulate ios</code>, but that&rsquo;s for losers.</p>

<p>Within in the project root, run either of these bad boys:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>gulp build
</span><span class='line'>gulp emulate
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s right, one command to rule them all. <code>gulp emulate</code> transpiles the code, moves it to <code>cordova/www</code> then kicks off the Cordova <code>build</code> and <code>emulate</code> commands.</p>

<p>&ldquo;But how does this sorcery work?&rdquo; I hear you cry. Cordova developers will mostly recognise Cordova&rsquo;s <a href="https://www.npmjs.com/">NPM</a> package as a command line tool, but as such a package, we should also be able to require it within a Node script (or in this case, Gulp). The reference here, <code>cordova = require('cordova-lib').cordova.raw</code>, provides access to the Cordova&rsquo;s underlying API, exposing stuff like <code>build</code> and <code>emulate</code>.</p>

<p>It&rsquo;s not all unicorns mind; the API has auto-detection routine in place that works out the project&rsquo;s root directory. This only works however, if you&rsquo;re within Cordova&rsquo;s project structure. I&rsquo;m positive this can be overcome by &lsquo;cleaner&rsquo; methods of API abstraction, but for the moment I&rsquo;ve circumvented the issue by introducing two calls to <code>process.chdir</code>. <code>chdir</code> changes the working directory of running script. The second call resets the directory, for the purposes of possible task chaining.</p>

<p>See here:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;emulate&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;compile&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">process</span><span class="p">.</span><span class="nx">chdir</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/cordova&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">cordova</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">run</span><span class="p">({</span> <span class="nx">platforms</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;ios&#39;</span> <span class="p">]</span> <span class="p">})</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">process</span><span class="p">.</span><span class="nx">chdir</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">cb</span><span class="p">();</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>We change the directory.</li>
<li>We call <code>run</code>. <code>emulate</code> is an alias for <code>run</code>.</li>
<li>When the <code>run</code> process completes, the directory is reset.</li>
</ol>


<p>So there you have it, in a single Gulp command you can, transpile, populate, build and emulate. For me, this little nugget has sped up my workflow, and has made the build task more approachable to other developers working on the project.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[In the Name of Gulp]]></title>
    <link href="http://rich.k3r.me/blog/2015/03/23/in-the-name-of-gulp/"/>
    <updated>2015-03-23T22:41:47+00:00</updated>
    <id>http://rich.k3r.me/blog/2015/03/23/in-the-name-of-gulp</id>
    <content type="html"><![CDATA[<p><em><strong>TL;DR:</strong> Use Gulp 4 if you care about task management. If you can&rsquo;t use Gulp 4, use Gulp 3 with &lsquo;runSequence&rsquo;. Also, I need to start reading documentation more and assuming less.</em></p>

<p><em><strong>NOTE:</strong> You see the code over at <a href="https://github.com/kim3er/gulp-4-demo">Github</a>.</em></p>

<p>The release of Gulp 4 is right around the corner, but you can already use it on the <a href="https://github.com/gulpjs/gulp/tree/4.0">4.0 branch</a>. Here is why you should.</p>

<!-- more -->


<h2>Feelings of inadequacy</h2>

<p>When <a href="http://gruntjs.com/">Grunt</a> gained popularity, I was excited by the premise, but underwhelmed by the execution. I feel this is more due to a deficiency on my part, rather than an actual problem with Grunt, given the <a href="http://gruntjs.com/development-team">team</a> behind it. Just looking at the <a href="http://gruntjs.com/getting-started">Getting Started</a> page causes static to course through my brain. #brains</p>

<p>This feeling of inadequacy stayed with me until I found <a href="https://github.com/gulpjs/gulp">Gulp</a>. Gulp&rsquo;s barrier to entry seems a lot lower than Grunt&rsquo;s, it&rsquo;s really a tool you can just run with. Now I feel great about myself, now that I&rsquo;ve found &lsquo;my people&rsquo;. Amen brothers and sisters, this is the house of Gulp.</p>

<h2>Asynchronous shrubs</h2>

<p>It&rsquo;s not all roses in the garden of Gulp 3 though, well maybe it is, but those roses have thorns. And those thorns all bare the words &lsquo;async callbacks&rsquo;. If you&rsquo;ve ever considered Gulp tasks to be modular, building blocks of larger tasks, then you&rsquo;ve probably faced the same disappointment that I have, that they&rsquo;re not.</p>

<p>Take this simple gulpfile:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">sass</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-sass&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">babel</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-babel&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">del</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;del&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">DEST</span> <span class="o">=</span> <span class="s1">&#39;./dest&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">SRC</span> <span class="o">=</span> <span class="s1">&#39;./src&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;clean&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">del</span><span class="p">(</span><span class="nx">DEST</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;stylesheets&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="nx">SRC</span> <span class="o">+</span> <span class="s1">&#39;/app.scss&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">sass</span><span class="p">())</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">DEST</span><span class="p">));</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;javascripts&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="nx">SRC</span> <span class="o">+</span> <span class="s1">&#39;/app.js&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">babel</span><span class="p">({</span> <span class="nx">blacklist</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;useStrict&#39;</span> <span class="p">]</span> <span class="p">}))</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">DEST</span><span class="p">));</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="nx">SRC</span> <span class="o">+</span> <span class="s1">&#39;/app.html&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">DEST</span><span class="p">));</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;clean&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheets&#39;</span><span class="p">,</span> <span class="s1">&#39;javascripts&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>The script above takes the contents of <code>src</code> and sticks it in <code>dest</code>. There is a problem with the script above, that becomes apparent when you check the output:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>22:02:10<span class="o">]</span> Starting <span class="s1">&#39;clean&#39;</span>...
</span><span class='line'><span class="o">[</span>22:02:10<span class="o">]</span> Starting <span class="s1">&#39;stylesheets&#39;</span>...
</span><span class='line'><span class="o">[</span>22:02:10<span class="o">]</span> Starting <span class="s1">&#39;javascripts&#39;</span>...
</span><span class='line'><span class="o">[</span>22:02:10<span class="o">]</span> Starting <span class="s1">&#39;html&#39;</span>...
</span><span class='line'><span class="o">[</span>22:02:10<span class="o">]</span> Finished <span class="s1">&#39;clean&#39;</span> after <span class="m">23</span> ms
</span><span class='line'><span class="o">[</span>22:02:10<span class="o">]</span> Finished <span class="s1">&#39;javascripts&#39;</span> after <span class="m">48</span> ms
</span><span class='line'><span class="o">[</span>22:02:10<span class="o">]</span> Finished <span class="s1">&#39;html&#39;</span> after <span class="m">45</span> ms
</span><span class='line'><span class="o">[</span>22:02:10<span class="o">]</span> Finished <span class="s1">&#39;stylesheets&#39;</span> after <span class="m">55</span> ms
</span><span class='line'><span class="o">[</span>22:02:10<span class="o">]</span> Starting <span class="s1">&#39;default&#39;</span>...
</span><span class='line'><span class="o">[</span>22:02:10<span class="o">]</span> Finished <span class="s1">&#39;default&#39;</span> after <span class="m">12</span> μs
</span></code></pre></td></tr></table></div></figure>


<p>Look at the fifth entry, it&rsquo;s the <code>clean</code> task finishing after 23 milliseconds, after all the other tasks have already started. So the clean script is still deleting stuff after the other tasks have started moving their stuff across.</p>

<h2>Something funny about iteration</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;clean&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="p">[</span> <span class="s1">&#39;stylesheets&#39;</span><span class="p">,</span> <span class="s1">&#39;javascripts&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span> <span class="p">].</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">taskName</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">gulp</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="nx">taskName</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>With the <code>default</code> task above, the <code>clean</code> task will complete before any other task starts; no more conflict. Thing is though, looking at the output, the <code>default</code> task is the first to finish after <code>clean</code>. Because Gulp tasks are asynchronous (non blocking), the <code>default</code> task has no reason to hang around waiting for all the tasks in the <code>forEach</code> to complete; the code is only interested in starting each task. This isn&rsquo;t a big deal in our example, but what if you then needed to add a third step?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;clean&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="p">[</span> <span class="s1">&#39;stylesheets&#39;</span><span class="p">,</span> <span class="s1">&#39;javascripts&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span> <span class="p">].</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">taskName</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">gulp</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="nx">taskName</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="nx">cb</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;build&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;deploy!&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;deploy&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Check out the output:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>22:28:20<span class="o">]</span> Starting <span class="s1">&#39;clean&#39;</span>...
</span><span class='line'><span class="o">[</span>22:28:20<span class="o">]</span> Finished <span class="s1">&#39;clean&#39;</span> after 8.59 ms
</span><span class='line'><span class="o">[</span>22:28:20<span class="o">]</span> Starting <span class="s1">&#39;build&#39;</span>...
</span><span class='line'><span class="o">[</span>22:28:20<span class="o">]</span> Starting <span class="s1">&#39;stylesheets&#39;</span>...
</span><span class='line'><span class="o">[</span>22:28:20<span class="o">]</span> Starting <span class="s1">&#39;javascripts&#39;</span>...
</span><span class='line'><span class="o">[</span>22:28:20<span class="o">]</span> Starting <span class="s1">&#39;html&#39;</span>...
</span><span class='line'><span class="o">[</span>22:28:20<span class="o">]</span> Finished <span class="s1">&#39;build&#39;</span> after <span class="m">10</span> ms
</span><span class='line'><span class="o">[</span>22:28:20<span class="o">]</span> Starting <span class="s1">&#39;deploy&#39;</span>...
</span><span class='line'>deploy!
</span><span class='line'><span class="o">[</span>22:28:20<span class="o">]</span> Finished <span class="s1">&#39;deploy&#39;</span> after <span class="m">59</span> μs
</span><span class='line'><span class="o">[</span>22:28:20<span class="o">]</span> Starting <span class="s1">&#39;default&#39;</span>...
</span><span class='line'><span class="o">[</span>22:28:20<span class="o">]</span> Finished <span class="s1">&#39;default&#39;</span> after 2.89 μs
</span><span class='line'><span class="o">[</span>22:28:20<span class="o">]</span> Finished <span class="s1">&#39;html&#39;</span> after <span class="m">42</span> ms
</span><span class='line'><span class="o">[</span>22:28:20<span class="o">]</span> Finished <span class="s1">&#39;javascripts&#39;</span> after <span class="m">45</span> ms
</span><span class='line'><span class="o">[</span>22:28:20<span class="o">]</span> Finished <span class="s1">&#39;stylesheets&#39;</span> after <span class="m">52</span> ms
</span></code></pre></td></tr></table></div></figure>


<p>The <code>deploy</code> task finishes before the <code>build</code> tasks have completed, which is obviously not ideal!</p>

<h2>My &lsquo;go to&rsquo; for async code (given up on the &lsquo;humor&rsquo;)</h2>

<p>I had expected to find that the <code>start</code> function would support a callback or even an event emitter. That being the case, we could use something like <a href="https://github.com/caolan/async">async</a> (a neat package for dealing with asynchronous code) to do something like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">async</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">eachSeries</span><span class="p">(</span>
</span><span class='line'>      <span class="p">[</span> <span class="s1">&#39;stylesheets&#39;</span><span class="p">,</span> <span class="s1">&#39;javascripts&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span> <span class="p">],</span>
</span><span class='line'>      <span class="kd">function</span><span class="p">(</span><span class="nx">taskName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">gulp</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="nx">taskName</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">callback</span><span class="p">();</span> <span class="p">});</span>
</span><span class='line'>          <span class="c1">// or</span>
</span><span class='line'>          <span class="c1">// gulp.start(taskName).on(&#39;end&#39;, callback);</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">cb</span><span class="p">()</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>But alas, not. The <code>start</code> function is fire and forget. In the example above, crazy stuff happens in the output:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>20:34:15<span class="o">]</span> Starting <span class="s1">&#39;clean&#39;</span>...
</span><span class='line'><span class="o">[</span>20:34:15<span class="o">]</span> Finished <span class="s1">&#39;clean&#39;</span> after 8.25 ms
</span><span class='line'><span class="o">[</span>20:34:15<span class="o">]</span> Starting <span class="s1">&#39;build&#39;</span>...
</span><span class='line'><span class="o">[</span>20:34:15<span class="o">]</span> Starting <span class="s1">&#39;stylesheets&#39;</span>...
</span><span class='line'><span class="o">[</span>20:34:15<span class="o">]</span> Finished <span class="s1">&#39;stylesheets&#39;</span> after <span class="m">25</span> ms
</span></code></pre></td></tr></table></div></figure>


<h2>&lsquo;runSequence&rsquo;, a beautiful stopgap</h2>

<p>What you need, is an unassuming, wicked little plugin called <a href="https://www.npmjs.com/package/run-sequence">run-sequence</a>. Using &lsquo;run-sequence&rsquo;, you can do something like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;clean&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">runSequence</span><span class="p">(</span>
</span><span class='line'>      <span class="p">[</span> <span class="s1">&#39;stylesheets&#39;</span><span class="p">,</span> <span class="s1">&#39;javascripts&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span> <span class="p">],</span>
</span><span class='line'>      <span class="nx">cb</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can see from the output that we get exactly what we want:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>20:41:34<span class="o">]</span> Starting <span class="s1">&#39;clean&#39;</span>...
</span><span class='line'><span class="o">[</span>20:41:34<span class="o">]</span> Finished <span class="s1">&#39;clean&#39;</span> after 8.18 ms
</span><span class='line'><span class="o">[</span>20:41:34<span class="o">]</span> Starting <span class="s1">&#39;build&#39;</span>...
</span><span class='line'><span class="o">[</span>20:41:34<span class="o">]</span> Starting <span class="s1">&#39;stylesheets&#39;</span>...
</span><span class='line'><span class="o">[</span>20:41:34<span class="o">]</span> Starting <span class="s1">&#39;javascripts&#39;</span>...
</span><span class='line'><span class="o">[</span>20:41:34<span class="o">]</span> Starting <span class="s1">&#39;html&#39;</span>...
</span><span class='line'><span class="o">[</span>20:41:34<span class="o">]</span> Finished <span class="s1">&#39;html&#39;</span> after <span class="m">44</span> ms
</span><span class='line'><span class="o">[</span>20:41:34<span class="o">]</span> Finished <span class="s1">&#39;stylesheets&#39;</span> after <span class="m">54</span> ms
</span><span class='line'><span class="o">[</span>20:41:34<span class="o">]</span> Finished <span class="s1">&#39;javascripts&#39;</span> after <span class="m">49</span> ms
</span><span class='line'><span class="o">[</span>20:41:34<span class="o">]</span> Finished <span class="s1">&#39;build&#39;</span> after <span class="m">56</span> ms
</span><span class='line'><span class="o">[</span>20:41:34<span class="o">]</span> Starting <span class="s1">&#39;deploy&#39;</span>...
</span><span class='line'>deploy!
</span><span class='line'><span class="o">[</span>20:41:34<span class="o">]</span> Finished <span class="s1">&#39;deploy&#39;</span> after <span class="m">81</span> μs
</span><span class='line'><span class="o">[</span>20:41:34<span class="o">]</span> Starting <span class="s1">&#39;default&#39;</span>...
</span><span class='line'><span class="o">[</span>20:41:34<span class="o">]</span> Finished <span class="s1">&#39;default&#39;</span> after 3.88 μs
</span></code></pre></td></tr></table></div></figure>


<p>&lsquo;run-sequence&rsquo; is cool, but there is a better way.</p>

<h2>The point of the post</h2>

<p>Gulp 4 uses <a href="https://github.com/phated/undertaker">undertaker</a> for task management. This is significant because &lsquo;undertaker&rsquo; supports the chaining of series and parallel tasks. In order to make use of this functionality, you need to install the prerelease version of Gulp, which is easily done by following this <a href="http://demisx.github.io/gulp4/2015/01/15/install-gulp4.html">guide</a>.</p>

<p>You can see examples of series and parallel functionality, <a href="https://github.com/gulpjs/gulp/blob/4.0/docs/recipes/running-tasks-in-series.md">here</a>, but check this out:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">series</span><span class="p">(</span><span class="s1">&#39;clean&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheets&#39;</span><span class="p">,</span> <span class="s1">&#39;javascripts&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">series</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;deploy!&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">cb</span><span class="p">();</span>
</span><span class='line'><span class="p">}));</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">series</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>The difference here is that the dependancies array and callback have been replaced with chain-able <code>series</code> functions. You can see from the output below that, while the <code>deploy</code> task appears to start too early, the <code>console.log</code> demonstrates that the meat and veg of the task runs when it needs to.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>21:39:29<span class="o">]</span> Starting <span class="s1">&#39;default&#39;</span>...
</span><span class='line'><span class="o">[</span>21:39:29<span class="o">]</span> Starting <span class="s1">&#39;deploy&#39;</span>...
</span><span class='line'><span class="o">[</span>21:39:29<span class="o">]</span> Starting <span class="s1">&#39;build&#39;</span>...
</span><span class='line'><span class="o">[</span>21:39:29<span class="o">]</span> Starting <span class="s1">&#39;clean&#39;</span>...
</span><span class='line'><span class="o">[</span>21:39:29<span class="o">]</span> Finished <span class="s1">&#39;clean&#39;</span> after 8.95 ms
</span><span class='line'><span class="o">[</span>21:39:29<span class="o">]</span> Starting <span class="s1">&#39;stylesheets&#39;</span>...
</span><span class='line'><span class="o">[</span>21:39:29<span class="o">]</span> Finished <span class="s1">&#39;stylesheets&#39;</span> after <span class="m">17</span> ms
</span><span class='line'><span class="o">[</span>21:39:29<span class="o">]</span> Starting <span class="s1">&#39;javascripts&#39;</span>...
</span><span class='line'><span class="o">[</span>21:39:29<span class="o">]</span> Finished <span class="s1">&#39;javascripts&#39;</span> after <span class="m">32</span> ms
</span><span class='line'><span class="o">[</span>21:39:29<span class="o">]</span> Starting <span class="s1">&#39;html&#39;</span>...
</span><span class='line'><span class="o">[</span>21:39:29<span class="o">]</span> Finished <span class="s1">&#39;html&#39;</span> after 2.98 ms
</span><span class='line'><span class="o">[</span>21:39:29<span class="o">]</span> Finished <span class="s1">&#39;build&#39;</span> after <span class="m">62</span> ms
</span><span class='line'><span class="o">[</span>21:39:29<span class="o">]</span> Starting <span class="s1">&#39;&lt;anonymous&gt;&#39;</span>...
</span><span class='line'>deploy!
</span><span class='line'><span class="o">[</span>21:39:29<span class="o">]</span> Finished <span class="s1">&#39;&lt;anonymous&gt;&#39;</span> after <span class="m">222</span> μs
</span><span class='line'><span class="o">[</span>21:39:29<span class="o">]</span> Finished <span class="s1">&#39;deploy&#39;</span> after <span class="m">63</span> ms
</span><span class='line'><span class="o">[</span>21:39:29<span class="o">]</span> Finished <span class="s1">&#39;default&#39;</span> after <span class="m">65</span> ms
</span></code></pre></td></tr></table></div></figure>


<p>To sum up. Gulp 4 is a huge step forward in terms of task management. I&rsquo;ve had no problems with v4 so far, but if you need to hang with v3 for a little while longer, &lsquo;run-sequence&rsquo; is a good option.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Comics: The DRM Effect]]></title>
    <link href="http://rich.k3r.me/blog/2015/03/05/comics-the-drm-effect/"/>
    <updated>2015-03-05T07:42:41+00:00</updated>
    <id>http://rich.k3r.me/blog/2015/03/05/comics-the-drm-effect</id>
    <content type="html"><![CDATA[<p>When I transitioned from paper to digital, I didn&rsquo;t just reclaim floor space in my loft, I picked up a more eclectic taste in reading material as well. For the most part, I suspect happenstance of maturity in tastes and storage reclamation. One factor, that at least in part, can be attributed to my personal comic book renaissance, is DRM. Which is funny, because I bloody hate DRM.</p>

<!-- more -->


<p>DRM exposes the shame that we don&rsquo;t really own anything. Buy &ldquo;A New Hope&rdquo; of VHS, then wait for the format to become obsolete. Buy it DRM through iTunes, has it really got any less of a shelf life. How many times have we bought the original Star Wars trilogy (to own), throughout our lives. I&rsquo;ve bought it three times, twice on VHS, once on DVD. I will not replace the DVDs, unless the movie industry goes DRM free or Disney release an irresistible boxset. Ah, shit.</p>

<p>At first, I took the approach with comics, that I still take with my digital movie collection, that DRM is a fact of life. If you want to see the movie, it&rsquo;s either DRM or a hard copy. I don&rsquo;t want a hard copy. As a side issue, this is why I have not seen Twelve Monkeys in such a long time (not available in the UK to stream, is never on the TV).</p>

<p>With comics, there is a third option that has just become a lot more popular. DRM-free comics. Look, I&rsquo;m not saying they&rsquo;re new, just that your options have recently increased, albeit at the sacrifice of other ethical issues. What am I talking about? Comixology, a firm favourite of mine for reading digital comics, made the monumental step of allowing creators to offer their comics DRM-free. This is a truly amazing step forward in my view. So, what about the ethics? Man it&rsquo;s annoying that they&rsquo;ve been taken over by (the UK tax dodging poster boys) Amazon.</p>

<p>I hate that I&rsquo;m so invested in this company.</p>

<ul>
<li>I use Amazon Prime, because they have some great streaming options. DRM protected.</li>
<li>I use Audible. Amazon &amp; DRM protected! But the best source of audio books I&rsquo;ve found.</li>
<li>I have a Kindle, because it&rsquo;s easily the best device for reading, which also ties in with Audible. Also DRM protected.</li>
<li>And now, now my comics are purchased through Amazon as well. Arrrgh. The one saving grace being that DRM is optional.</li>
</ul>


<p>Let&rsquo;s save my ethical crises for another post. It&rsquo;s unlikely that Marvel or DC are going to be clicking the &ldquo;DRM-free&rdquo; button anytime soon. Dark Horse have their own service which is still disappointingly DRM protected. All of which means that if you want a DRM-free comic book library, you have to look at other publishers.</p>

<p>2000 AD have been selling their entire digital catalogue,  DRM-free for a good while now, and they deserve nothing but praise for it. Because of this, I&rsquo;ve rekindled my love of their periodical, as well as discovering some real classic gems. Halo Jones is the one that comes immediately to mind. If I have one gripe with 2000 AD, it&rsquo;s its clunky checkout process. No ability to save card details or use Paypal. If the process of buying comics was easier, I&rsquo;d regrettably be spending more. I know this is true because of in spite of my ethical crises, the Comixology checkout process is smooth like butter. So smooth, it&rsquo;s a little unsettling at times.</p>

<p>I don&rsquo;t just read DRM-free comics. I read a few titles, like Powers, Hellboy &amp; Atomic Robo that are so far not free of their DRM shackles. Here though, I end this post with some DRM-free recommendations.</p>

<h2>2000 AD</h2>

<ul>
<li><a href="http://shop.2000adonline.com/products/ballad_of_halo_jones">The Ballad of Halo Jones</a> - I love this book so much. It&#8217;a true space opera in comic form. Reminiscent of Ender&rsquo;s Game and Forever War.</li>
<li><a href="http://shop.2000adonline.com/digital/comics">2000 AD</a> - I&rsquo;m on #1679. So many stories, so much beautiful artwork. I couldn&rsquo;t hope to remember them all. Shakara!</li>
</ul>


<h2>Comixology</h2>

<ul>
<li><a href="https://www.comixology.co.uk/Bitch-Planet/comics-series/30465">Bitch Planet</a> - I&rsquo;m three issues in, and it&rsquo;s really good. The art is so cool, very pulpy. The story has kicked off to a great start.</li>
<li><a href="https://www.comixology.co.uk/Elephantmen/comics-series/654">Elephantmen</a> - I admit, I&rsquo;ve not read this one in a little while, but I was happy to see it go DRM-free. I&rsquo;m hovering around #28. It&rsquo;s a gritty piece of work and I like how the different threads work together.</li>
<li><a href="https://www.comixology.co.uk/Morning-Glories/comics-series/4617">Morning Glories</a> - Not my usual bag, but the story is compelling. I&rsquo;m on #15.</li>
<li><a href="https://www.comixology.co.uk/Jack-Staff/comics-series/686">Jack Staff</a> - The artwork is awesome. The stories for the most part are great, with a lot of funny references, familiar to those of a British upbringing.</li>
<li><a href="https://www.comixology.co.uk/The-Life-After/comics-series/21882">The Life After</a> - I really love the art in this book. I&rsquo;m on #3, and so far, it&rsquo;s very original, very surreal.</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[localForage for Cross-platform Storage]]></title>
    <link href="http://rich.k3r.me/blog/2015/02/28/localforage-for-cross-platform-storage/"/>
    <updated>2015-02-28T09:30:05+00:00</updated>
    <id>http://rich.k3r.me/blog/2015/02/28/localforage-for-cross-platform-storage</id>
    <content type="html"><![CDATA[<p><em>TL;DR: You should be using <a href="https://mozilla.github.io/localForage/">localForage</a> for all your web based local storage needs. It&rsquo;s wonderful.</em></p>

<p>Storage in general is a bit of a tricky one in hybrid development. There are three main types of storage (excluding bespoke implementations and filesystem) you potentially have access to in a web based development:</p>

<!-- more -->


<h2>localStorage</h2>

<p>Until recently, my &ldquo;go to guy&rdquo; for app storage. localStorage is really easy to use key-value storage, that is at the time of writing, the only consistent cross-platform storage mechanism. The problem with localStorage though, is that you typically only get access to 5MB. This has always been sufficient for my needs in the past, but you can&rsquo;t help thinking that&rsquo;s a scalability problem waiting to happen. The limit speaks to the intended use for this sort of storage; if you&rsquo;ve a lot of data, look somewhere else.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://caniuse.com/#feat=namevalue-storage">Compatibility</a></p>

<h2>WebSQL</h2>

<p>WebSQL is an implementation of Sqlite, which is great, because I love Sqlite. What is not so great is that there is no support for IE/Firefox, and non seemingly on the horizon. I suspect it&rsquo;s due to the lack of involvement from two major vendors, that <a href="http://en.wikipedia.org/wiki/Web_SQL_Database">W3C ceased working on the specification in November 2010</a>. No more to be said.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">database</span> <span class="o">=</span> <span class="nx">openDatabase</span><span class="p">(</span><span class="s1">&#39;testDB&#39;</span><span class="p">,</span> <span class="s1">&#39;1.0&#39;</span><span class="p">,</span> <span class="s1">&#39;Test Database&#39;</span><span class="p">,</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">);</span>
</span><span class='line'><span class="nx">database</span><span class="p">.</span><span class="nx">transaction</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">transaction</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>   <span class="nx">transaction</span><span class="p">.</span><span class="nx">executeSql</span><span class="p">(</span><span class="s1">&#39;CREATE TABLE IF NOT EXISTS entries (id INTEGER PRIMARY KEY, value VARCHAR)&#39;</span><span class="p">);</span>
</span><span class='line'>   <span class="nx">transaction</span><span class="p">.</span><span class="nx">executeSql</span><span class="p">(</span><span class="s1">&#39;INSERT INTO entries (value) VALUES (&quot;value&quot;)&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://caniuse.com/#feat=sql-storage">Compatibility</a></p>

<h2>IndexedDB</h2>

<p>IndexedDB has gained <a href="http://www.girliemac.com/blog/2014/07/03/indexeddb/">greater platform support of late</a>. Even so, with support having only just been implemented in iOS &amp; Android, legacy support is an issue. The Blob support is really interesting. But actually, beyond what I&rsquo;ve read, I don&rsquo;t know too much about IndexedDB, I&rsquo;ve never really used it.</p>

<p><em>NOTE: I went hunting around for an example for IndexedDB, the best article I came across was <a href="http://code.tutsplus.com/tutorials/working-with-indexeddb--net-34673">this one</a>.  Wow, is IndexedDB long winded or what?!</em></p>

<p><a href="http://caniuse.com/#feat=indexeddb">Compatibility</a></p>

<p>So, which storage mechanism am I using? Well, I&rsquo;m probably using IndexedDB in most cases. Ehh? I recently had call to convert a Cordova app to a Chrome app. The app in question was using localStorage. Trick is, Chrome apps don&rsquo;t support standard localStorage. They have their own version (called <a href="https://developer.chrome.com/apps/storage">chrome.storage</a>) that is very similar to localStorage, but is asynchronous nature. I didn&rsquo;t really want to rewrite the whole data layer specifically to work with Chrome app, but I found the idea of making it  asynchronous appealing . Maybe it was time to break my reliance on localStorage.</p>

<p>I found <a href="https://mozilla.github.io/localForage/">localForage</a>, a Mozilla library that wraps localStorage, WebSQL and IndexedDB into asynchronous localStorage API. Perfect! The library basically uses whatever is available; You can even set or of precedence and write your own adapters (I&rsquo;m thinking <a href="https://developer.chrome.com/apps/storage#property-sync">chrome.storage.sync</a>).</p>

<p>Below is a fragment of the code I&rsquo;ve converted to use localForage. The JavaScript is written using ES6.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">class</span> <span class="nx">InternalStorage</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">constructor</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">_serialize</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">_deserialize</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">_getIndexKey</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_key</span> <span class="o">+</span> <span class="s1">&#39;-index&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">getIndex</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_getIndexKey</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_deserialize</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="p">[];</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">setIndex</span><span class="p">(</span><span class="nx">array</span><span class="o">=</span><span class="p">[])</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_serialize</span><span class="p">(</span><span class="nx">array</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_getIndexKey</span><span class="p">(),</span> <span class="nx">obj</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here is the converted code, using localForage:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">class</span> <span class="nx">InternalStorage</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">constructor</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span> <span class="o">=</span> <span class="nx">localforage</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">_serialize</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">_deserialize</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">_getIndexKey</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_key</span> <span class="o">+</span> <span class="s1">&#39;-index&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">getIndex</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">self</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">_getIndexKey</span><span class="p">())</span>
</span><span class='line'>              <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">_deserialize</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span> <span class="p">});</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">setIndex</span><span class="p">(</span><span class="nx">array</span><span class="o">=</span><span class="p">[])</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_serialize</span><span class="p">(</span><span class="nx">array</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_getIndexKey</span><span class="p">(),</span> <span class="nx">obj</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The things to notice with the transition to localForage are:</p>

<ul>
<li>No requirement to serialise/deserialise, as localForage deals with this.</li>
<li>localForage returns an ES6 Promise, so, so does <code>setIndex</code>.</li>
<li>I&rsquo;ve wrapped the logic for <code>getIndex</code> in a Promise, so I can keep my <code>_serialize</code> method in place. Well, you never know.</li>
</ul>


<p>ES6 is a big thing for me at the moment, so the fact that localForage supports ES6 compliant promises, was very appealing. The ability to write additional adapters adds future proofing. My one gripe, which isn&rsquo;t an issue with localForage, is that we don&rsquo;t have a robust solution for relational storage in our web based development at the moment.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Page Attributes in Perch]]></title>
    <link href="http://rich.k3r.me/blog/2015/02/19/page-attributes-in-perch/"/>
    <updated>2015-02-19T07:52:05+00:00</updated>
    <id>http://rich.k3r.me/blog/2015/02/19/page-attributes-in-perch</id>
    <content type="html"><![CDATA[<p>Page Attributes allow you to add editable content at the page level, rather than on a content level. The syntax is almost identical to that of a standard content region. Below is an extract of <code>perch/templates/pages/attributes/seo.html</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;perch:pages</span> <span class="na">id=</span><span class="s">&quot;description&quot;</span> <span class="na">label=</span><span class="s">&quot;Description&quot;</span> <span class="na">type=</span><span class="s">&quot;textarea&quot;</span> <span class="na">size=</span><span class="s">&quot;xs&quot;</span> <span class="na">escape=</span><span class="s">&quot;true&quot;</span> <span class="na">count=</span><span class="s">&quot;chars&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<!--more-->


<p><em>If you&rsquo;re not already familiar with how to implement Page Attributes, I urge you to check out Perch&rsquo;s <a href="http://docs.grabaperch.com/docs/pages/page-attributes/">docs</a>. The implementation is simple, and as the builtin example suggests, very effective for SEO.</em></p>

<p>This is a somewhat contrived example, but should hopefully demonstrate the flexibility that page attributes add to Perch. Imagine a website that contains a list of projects. The home page contains a list of the titles of those projects, and a link to view more information. The list is generated using the <a href="http://docs.grabaperch.com/docs/navigation/perch-pages-navigation/">perch_pages_navigation</a> function.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span> <span class="nx">perch_pages_navigation</span><span class="p">(</span><span class="k">array</span><span class="p">(</span> <span class="s1">&#39;from-path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;*&#39;</span> <span class="p">));</span> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;d like the list to include a thumbnail and a small excerpt of the project description. I&rsquo;ve already provided a <a href="http://rich.k3r.me/blog/2015/01/14/flexible-index-pages-in-perch/">tutorial</a> on a flexible approach for achieving this, but perhaps it&rsquo;s a bit overkill for the immediate needs of the client. With Page Attributes we can fresh out our index page, with an image and an excerpt, with very little effort.</p>

<p>Adding the following to <code>perch/templates/pages/attributes/default.html</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;perch:pages</span> <span class="na">id=</span><span class="s">&quot;image&quot;</span> <span class="na">label=</span><span class="s">&quot;Image&quot;</span> <span class="na">type=</span><span class="s">&quot;image&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;perch:pages</span> <span class="na">id=</span><span class="s">&quot;excerpt&quot;</span> <span class="na">label=</span><span class="s">&quot;Excerpt&quot;</span> <span class="na">type=</span><span class="s">&quot;textarea&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Adds two additional fields in the Page Details section of all pages.</p>

<p><img src="http://rich.k3r.me/images/page-attributes-1.png" alt="Page Attributes added" /></p>

<p>This new content is saved at a page level, so it can now be exposed in our index page using our existing <code>perch_pages_navigation</code> implementation. By modifying &lsquo;perch/templates/navigation/item.html&rsquo; to the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;perch:before&gt;</span>
</span><span class='line'>    <span class="nt">&lt;ul&gt;</span>
</span><span class='line'><span class="nt">&lt;/perch:before&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li</span><span class="err">&lt;</span><span class="na">perch:if</span> <span class="na">exists=</span><span class="s">&quot;current_page&quot;</span><span class="nt">&gt;</span> class=&quot;selected&quot;<span class="nt">&lt;/perch:if&gt;&lt;perch:if</span> <span class="na">exists=</span><span class="s">&quot;ancestor_page&quot;</span><span class="nt">&gt;</span> class=&quot;ancestor&quot;<span class="nt">&lt;/perch:if&gt;</span>&gt;
</span><span class='line'>            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&lt;perch:pages id=&quot;</span><span class="na">pagePath</span><span class="err">&quot;</span> <span class="nt">/&gt;</span>&quot;&gt;
</span><span class='line'>              <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;&lt;perch:pages id=&quot;</span><span class="na">image</span><span class="err">&quot;</span> <span class="nt">/&gt;</span>&quot; alt=&quot;<span class="nt">&lt;perch:pages</span> <span class="na">id=</span><span class="s">&quot;pageNavText&quot;</span> <span class="nt">/&gt;</span>&quot;&gt;
</span><span class='line'>              <span class="nt">&lt;h1&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;perch:pages</span> <span class="na">id=</span><span class="s">&quot;pageNavText&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>              <span class="nt">&lt;p&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;perch:pages</span> <span class="na">id=</span><span class="s">&quot;excerpt&quot;</span> <span class="na">label=</span><span class="s">&quot;Excerpt&quot;</span> <span class="na">type=</span><span class="s">&quot;textarea&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>            <span class="nt">&lt;perch:pages</span> <span class="na">id=</span><span class="s">&quot;subitems&quot;</span> <span class="na">encode=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/li&gt;</span>
</span><span class='line'><span class="nt">&lt;perch:after&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'><span class="nt">&lt;/perch:after&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The outputted HTML of our index page would resemble:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ul&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/industries/project-1.php&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;/perch/resources/project-thumb.jpg&quot;</span> <span class="na">alt=</span><span class="s">&quot;Project 1&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;h1&gt;</span>
</span><span class='line'>              Project 1
</span><span class='line'>          <span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>          <span class="nt">&lt;p&gt;</span>
</span><span class='line'>              Project Excerpt
</span><span class='line'>          <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/li&gt;</span>
</span><span class='line'><span class="nt">&lt;/ul&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can see how quickly we can expose, and gain access to, page level content with Page Attributes. This technique may well fit the bill for you immediate requirements. Before committing to this course of action though, see my previously mentioned <a href="http://rich.k3r.me/blog/2015/01/14/flexible-index-pages-in-perch/">tutorial</a>, you should be aware of the following aspects of Page Attributes:</p>

<ol>
<li>The new fields are hidden away in the Page Details tab. The content we enter for the index page, may have overlap with content being created for the project page. In this case it more sense to group all the content into content regions.</li>
<li>Through the use of &lsquo;Attribute templates&rsquo;, the user can select which attributes are configurable at a page level. However, there is no way for a new page to infer which template it should us. Which means that it is down to the user to make this decision each time, which in my opinion, limits the dropdown&rsquo;s usefulness.</li>
</ol>


<p>So there you are, Page Attributes. A pretty neat way to add a bit more oomph to your index pages.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Knowing Your Craft to the Rescue!]]></title>
    <link href="http://rich.k3r.me/blog/2015/02/12/knowing-your-craft-to-the-rescue/"/>
    <updated>2015-02-12T07:21:23+00:00</updated>
    <id>http://rich.k3r.me/blog/2015/02/12/knowing-your-craft-to-the-rescue</id>
    <content type="html"><![CDATA[<p>Just finished reading <a href="http://alistapart.com/column/what-will-save-us-from-the-dark-side-of-pre-processors">What Will Save Us from the Dark Side of CSS Pre-Processors?</a> on <a href="http://alistapart.com/">A List Apart</a>. I found the title and initial tone of the post confounding. And well, I probably read the post in the first instance, to shout down the wildly unfair negative connotations attached to preprocessors.</p>

<!-- more -->


<p>The thing is, I love preprocessors. I love them so much that I&rsquo;m currently brewing a series of posts extolling the virtues of preprocessors. Then I&rsquo;m faced by a post by A List Apart (a site I have a lot of respect for), apparently prophesying the demise of these little wonders. I couldn&rsquo;t let the post go, what if they were right?</p>

<p>After all, its up to all of us to constantly question everything we believe to be true. Right? Right.</p>

<p>The arguments set forth for the problems with preprocessors are:</p>

<ol>
<li><a href="http://alistapart.com/column/what-will-save-us-from-the-dark-side-of-pre-processors#section2">Unmindful use of preprocessors creates bloated output.</a></li>
<li><a href="http://alistapart.com/column/what-will-save-us-from-the-dark-side-of-pre-processors#section3">By adding a layer of abstraction on the base syntax, you&rsquo;re essentially locking yourself into it&rsquo;s Domain-Specific Language (DSL).</a></li>
</ol>


<p>Blaming the use of a preprocessor on the coder&rsquo;s own bad habits, is like blaming traffic cameras for speeding. To get the best out of a tool, you must use it correctly. I&rsquo;m no shining example of this! I frequently try to nail pictures to the wall with a screwdriver; I&rsquo;m forever using an unnecessary amount of nesting in my <a href="http://thesassway.com/intermediate/avoid-nested-selectors-for-more-modular-css">Sass</a>.</p>

<p>You can&rsquo;t deny &lsquo;lock-in&rsquo; effort of adding a preprocessor to a project. In much the same way, you could argue that choosing to write an application in a language like <a href="http://en.wikipedia.org/wiki/Ruby_(programming_language">Ruby</a>), locks the future development to the that language over say the base languages that Ruby is built on, like C or Java.</p>

<p>Well, that&rsquo;s not quite right, you could write a native extension for Ruby in C, if you wanted. Actually, this is why I use the SCSS syntax of Sass over SASS, and why I favour <a href="https://6to5.org/">6to5</a> over <a href="http://coffeescript.org/">CoffeeScript</a>. In both examples you can make use of all the wonderful syntactic sugar that the preprocessors provide, or ignore all of it and write in the base syntax. Let us not forget that we&rsquo;re never ever actually locked in by a good preprocessor, as its sole purpose is to generate the base syntax, so you can opt out at any time. &ldquo;Hey man, I don&rsquo;t need your syntactic goodness anymore, I&rsquo;m going to carry on with the base file&rdquo;.</p>

<p>A couple of issues are raised by my last paragraph:</p>

<ol>
<li><p><strong>I love Ruby for the same reason that I don&rsquo;t like CoffeeScript.</strong> This is a weirdness that actually Lyza (the original post&rsquo;s author) will be helping me with later in this post. I have no interest in writing a line of C. I adore JavaScript and have never warmed to CoffeeScript as an alternative.</p></li>
<li><p><strong>Why would you ever just  use the base syntax, if you&rsquo;d gone to the trouble of adding a preprocessor in the first place?</strong> I&rsquo;m completely non-dismissive of Lyza&rsquo;s arguments about the &lsquo;lock-in&rsquo; effect, or as I&rsquo;ve always thought of &lsquo;barrier to entry&rsquo; or &lsquo;learning curve&rsquo;. I work in a very talented dev team. We each come from different technological backgrounds and have our own preferences for tooling &amp; technology. If I&rsquo;m going to add a dependancy to the project, it better not be at the expense of a co-worker&rsquo;s ability to jump in.</p></li>
</ol>


<p>Its at the point where Lyza starts talking about post-processors, that my angst starts to wain. I&rsquo;d never heard of <a href="https://github.com/postcss/postcss">PostCSS</a> or <a href="http://www.myth.io/">Myth</a> and I&rsquo;m pretty excited about both. I use <a href="http://compass-style.org/">Compass</a> a lot; the moment that hooked me was realising that I didn&rsquo;t  have to hack around with nonsense bits of CSS, to add cross browser support for <code>inline-block</code>. Maybe though its time for a slightly different approach, in much the same way that I write ES6 compliant JavaScript and have a &ldquo;preprocessor&rdquo; called 6to5 convert it into something most browsers can work with (I realise I&rsquo;m talking about ES5). Perhaps I should be writing compliant CSS3 and have one of these &ldquo;post-processors&rdquo; add all the &ldquo;make it work in older browser&rdquo; stuff.</p>

<p><em>Note: I&rsquo;ve used some of those double quotes divisively, I wonder if you noticed. It seems to me that the use of &ldquo;pre&rdquo; and &ldquo;post&rdquo; refers to the point at which the code is compliant to a standard. So, 6to5 is actually a post-processor. I went to the site for clarification. 6to5 actually refers to itself as a <a href="http://en.wikipedia.org/wiki/Source-to-source_compiler">transpiler</a>, which is a marvellous way of avoiding a distinction that I care very little about.</em></p>

<p>In summation, Lyza&rsquo;s point (I believe) is that transpilers aren&rsquo;t there to cover up poor code, that diversity in one&rsquo;s approach (especially within a team) is good. If I&rsquo;m right, then I agree with her wholeheartedly in both regards. I don&rsquo;t agree with the negative connotations of so-called preprocessors &amp; post-proprocessors to get to these points though.</p>

<p>For my own part, Lyza&rsquo;s post is identified the different tacks I have been taking in my usage of transpilers in JavaScript and CSS. Its time to harmonise, where possible, starting with standards code and have the transpiler make it dirty. I won&rsquo;t be giving up my nesting anytime soon though.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The Problem With Web Comics]]></title>
    <link href="http://rich.k3r.me/blog/2015/02/05/the-problem-with-web-comics/"/>
    <updated>2015-02-05T21:26:56+00:00</updated>
    <id>http://rich.k3r.me/blog/2015/02/05/the-problem-with-web-comics</id>
    <content type="html"><![CDATA[<p>That&rsquo;s right, I&rsquo;m going to have quick whinge about web comics. You know, comics of (more often than not) an incredibly high quality, provided for free by their talented creators. It seems like an entirely justifiable premise doesn&rsquo;t it? Well, maybe&hellip; Let&rsquo;s give it a go and see where we end up.</p>

<!-- more -->


<p>You pick up a book, you read a chapter or two, stick a bookmark in, then set it down on you bedside table. The next time you pick that book up, you go straight to the bookmark and continue reading. I haven&rsquo;t done that for a while mind. I&rsquo;m a hoarder by nature, without the space to truly exercise the talent. So I made the decision a few years ago to go digital with all of my printed media, books, magazines and comics. It makes my inability to throw anything away, less of an issue.</p>

<p>The kindle makes reading a book very easy as a digital medium. I was more sceptical about whether I&rsquo;d get on with comics on a bright iPad screen, but the transition took and I&rsquo;m almost exclusively digital now. Don&rsquo;t get me wrong, paper is best - there is nothing like the smell of an old book - but digital is a good compromise. The only real issue I have with digital (as format) is that I am always scrabbling for something to read in the bath.</p>

<p>Okay, I&rsquo;m slowly getting off the point. The point I am trying to make is that, it took my a little while to buy into comics in a digital format, but once I was there, my appetite became insatiable. &ldquo;Need more input.&rdquo;</p>

<p>My taste in comics has changed quite a lot over the years. At the peak of my print comic reading, it was almost exclusively DC/Marvel cape books. Now, I read almost (there&rsquo;s that word again) no superhero books; my tastes are more fringe. I&rsquo;m looking for stories that surprise me in some way.</p>

<p>Enter web comics. Thank goodness, I thought we&rsquo;d never get there.</p>

<p>Not a totally altruistic endeavour on the part of the creator; web comics are a great way to demonstrate a new talent or get different ideas out there. Regardless of motive, &lsquo;free to read&rsquo; material is a win for the reader. It has led me personally to discover creators that I may not have found otherwise, and to purchases of those creator&rsquo;s commercial offerings. A memorable example of this happening, was after finding <a href="http://www.friendswithboys.com/">Friends With Boys</a> by <a href="http://www.faitherinhicks.com/">Faith Erin Hicks</a>, which led me to discovering books like The War at Ellsmere and Adventures of Superhero Girl.</p>

<p>With Friends With Boys, I started reading roughly halfway through the run. Having so much content already available got me hooked. I obsessively finished the rest of the story, ensuring to log on to the site for new content, the moment it was published. In this instance web comics really worked for me.</p>

<p>In other instances, web comics have also worked for me in the short strip format, like with <a href="http://oglaf.com/">Oglaf</a> (NSFW). Oglaf works, because a) the name is very easy to remember and b) the stories are very short and funny (and rude).</p>

<p>I&rsquo;m discussing virtues, when I should be discussing problems.</p>

<h2>Discoverability</h2>

<p>Really the only reliable way I&rsquo;ve had to find new web comics is by recommendation through <a href="http://io9.com/">io9</a>. I&rsquo;ve attempted to find other sources, but all too often the sites are outdated in style and content.</p>

<h2>Bookmarks</h2>

<p>If I&rsquo;m reading a purchased comic, I&rsquo;ll use <a href="https://www.comixology.co.uk/">Comixology</a> or <a href="http://www.bitolithic.com/comic-zeal/">Comic Zeal</a>. These apps are my &ldquo;easy reach&rdquo;, they&rsquo;re my bookmark.</p>

<p>Some web comics are published in blogs, some in more purpose built sites. Some web comics are published as little more than Javascript slideshows with no thought to browser history. Some sites read backwards (chronologically), some forwards.</p>

<p>Man, it&rsquo;s a mess if you just want to pick something up every now and then. It&rsquo;s enough to switch me off to most of them.</p>

<h2>Possible Solution</h2>

<p>The problem with web comics, I&rsquo;ve discovered while writing this post, is me (the reader). I expect too much I think, from something that is a) free and b) created by someone(s) who don&rsquo;t want spend their lives worrying over usability. I suspect they mainly want to write comics.</p>

<p>The solution, I&rsquo;ve often wondered, might be to have an episodic web comic publishing framework. A service that allowed content creators to upload at whatever frequency they liked, which would then be collected into an entity that could be navigated and bookmarked by the reader, through an app or a website.</p>

<p>The thing that has stopped me from creating such a service in the past (time aside), is the creator&rsquo;s original motive in uploading the comic in the first place.</p>

<ul>
<li>Would a delivery system such as the one I&rsquo;ve described, go against principles of the creator?</li>
<li>Does it remove the human element that encompasses a web comic?</li>
<li>Once the content is packaged in such a way, has it jumped ahead of its intended published form?</li>
<li>Are all those bloody adverts actually critical to the creator&rsquo;s original decision to publish in the first place?</li>
</ul>


<p>I don&rsquo;t know, maybe I&rsquo;ll have stab at that system in the future. If you&rsquo;ve made it to bottom of this post, I&rsquo;d be interested to hear how you manage your web comic reading. If you&rsquo;re a creator, I&rsquo;d be really interested in hearing about the thought process that goes into publishing a web comic, and whether you see a need for a better delivery system.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Helpers as Partial Controllers]]></title>
    <link href="http://rich.k3r.me/blog/2015/01/31/helpers-as-partial-controllers/"/>
    <updated>2015-01-31T18:08:46+00:00</updated>
    <id>http://rich.k3r.me/blog/2015/01/31/helpers-as-partial-controllers</id>
    <content type="html"><![CDATA[<p>This is the first of what I expect will be a series of posts, about revelations that are entirely obvious in hindsight, but whose simplicity had eluded me for so long.</p>

<p>I came to Rails from ASP.NET MVC (have I told you about my <a href="http://www.amazon.co.uk/ASP-Net-MVC-Cookbook-Andrew-Siemer/dp/1849690308">book</a>), as part of a three pronged transition:</p>

<ol>
<li>Microsoft stack > Open source stack</li>
<li>IDE (VS2010) > Smart text editor (TextMate at the time, now Sublime Text 3)</li>
<li>Windows PC > Mac</li>
</ol>


<!--more-->


<p>The one thing I remember missing most when transitioning from ASP.NET MVC to Rails, was not being able to <a href="http://haacked.com/archive/2009/11/18/aspnetmvc2-render-action.aspx/">render actions</a> within a view. I&rsquo;m not going to regurgitate Phil Haack&rsquo;s example here (by the way, when did he start working at Github? He was part of my MS dream team). Basically, what we&rsquo;re talking about is rendering a partial that is attached to a controller. This way the logic is as portable as the partial itself, without putting logic into the actual partial; something I used a lot in ASP.NET MVC.</p>

<h2>Where there&rsquo;s a will there&rsquo;s a gem</h2>

<p>When I&rsquo;d convinced myself there wasn&rsquo;t a direct replacement for this functionality, I went about searching for a gem. What I found, was <a href="https://github.com/apotonick/cells">Cells</a>. This is about four years ago now, so I&rsquo;m happy to see the gem is still so active. It is pretty much a direct replacement for the functionality I was looking for and I did use it for a few projects. Thing is though, it wasn&rsquo;t really clicking with the other Rails devs I was working with.</p>

<p>I think maybe it was an &ldquo;against the grain&rdquo;, purest, &ldquo;this isn&rsquo;t the Rails way&rdquo; sort of reaction. But maybe they just saw what I couldn&rsquo;t; that there is a very easy way to accomplish my specific requirement. Either way, after the initial surge of wanting to use every gem under the sum, you gradually begin wanting to slim down your dependancies, and well, Cells didn&rsquo;t make the cut.</p>

<h2>So, to the point. Helpers</h2>

<p>Oh my god, it&rsquo;s so obvious now. For years I was ruefully sticking logic directly into my partial views, thinking &ldquo;Well, if I can&rsquo;t render actions, what else can I do?&rdquo;. What a doofus.</p>

<p>On a recent project, I was tired of the <code>locals</code> syntax of a partial I was using quite a lot.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">render</span><span class="p">(</span> <span class="ss">partial</span><span class="p">:</span> <span class="s2">&quot;path/to/partial&quot;</span><span class="p">,</span> <span class="ss">locals</span><span class="p">:</span> <span class="p">{</span> <span class="ss">param_one</span><span class="p">:</span> <span class="s2">&quot;something&quot;</span> <span class="p">}</span> <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Really tiresome, I know. Anyway, as the partial was being used more, the logic being stuck into said partial was also increasing exponentially.</p>

<figure class='code'><figcaption><span>partial.html.erb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="cp">&lt;%</span>
</span><span class='line'><span class="n">param_three</span> <span class="o">=</span> <span class="kp">false</span> <span class="k">unless</span> <span class="n">defined?</span><span class="p">(</span> <span class="n">param_three</span> <span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">param_two</span> <span class="o">==</span> <span class="s2">&quot;Something&quot;</span>
</span><span class='line'>  <span class="n">param_one</span> <span class="o">=</span> <span class="s2">&quot;Something incredibly hideous&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;p class=&quot;</span><span class="cp">&lt;%=</span> <span class="s2">&quot;yuck&quot;</span> <span class="k">if</span> <span class="n">param_three</span> <span class="o">==</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x">&gt;</span>
</span><span class='line'><span class="x">  </span><span class="cp">&lt;%=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">param_two</span><span class="si">}</span><span class="s2"> - </span><span class="si">#{</span><span class="n">param_one</span><span class="si">}</span><span class="s2">&quot;</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;/p&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>In spite of the disgrace my partial had become, what really irked me was having to type in <code>locals</code> every time I rendered the partial. &ldquo;I know, I&rsquo;ll put it into a helper method&rdquo;, I thought.</p>

<figure class='code'><figcaption><span>something_helpers.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">SomethingHelpers</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">render_something</span><span class="p">(</span><span class="n">param_one</span><span class="p">,</span> <span class="n">param_two</span><span class="p">,</span> <span class="n">param_three</span> <span class="o">=</span> <span class="kp">false</span><span class="p">)</span>
</span><span class='line'>      <span class="n">render</span><span class="p">(</span> <span class="ss">partial</span><span class="p">:</span> <span class="s2">&quot;path/to/partial&quot;</span><span class="p">,</span> <span class="ss">locals</span><span class="p">:</span> <span class="p">{</span> <span class="ss">param_one</span><span class="p">:</span> <span class="n">param_one</span><span class="p">,</span> <span class="ss">param_two</span><span class="p">:</span> <span class="n">param_two</span><span class="p">,</span> <span class="ss">param_three</span><span class="p">:</span> <span class="n">param_three</span> <span class="p">})</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>And then the revelation, &ldquo;Hang on a minute, I can put my logic in here as well&rdquo;. Hello.</p>

<figure class='code'><figcaption><span>something_helpers.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">SomethingHelpers</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">render_something</span><span class="p">(</span><span class="n">param_one</span><span class="p">,</span> <span class="n">param_two</span><span class="p">,</span> <span class="n">param_three</span> <span class="o">=</span> <span class="kp">false</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">param_two</span> <span class="o">==</span> <span class="s2">&quot;Something&quot;</span>
</span><span class='line'>          <span class="n">param_one</span> <span class="o">=</span> <span class="s2">&quot;Something incredibly hideous&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">param_two</span><span class="si">}</span><span class="s2"> - </span><span class="si">#{</span><span class="n">param_one</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">render</span><span class="p">(</span> <span class="ss">partial</span><span class="p">:</span> <span class="s2">&quot;path/to/partial&quot;</span><span class="p">,</span> <span class="ss">locals</span><span class="p">:</span> <span class="p">{</span> <span class="ss">text</span><span class="p">:</span> <span class="n">text</span><span class="p">,</span> <span class="ss">param_three</span><span class="p">:</span> <span class="n">param_three</span> <span class="p">})</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>partial.html.erb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;p class=&quot;</span><span class="cp">&lt;%=</span> <span class="s2">&quot;yuck&quot;</span> <span class="k">if</span> <span class="n">param_three</span> <span class="o">==</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x">&gt;</span>
</span><span class='line'><span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">text</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;/p&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Seriously, sometimes I worry about me. I think I probably have this revelation every six months or so, then forget it. Hopefully after writing this, I won&rsquo;t forget again.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Casual Gaming]]></title>
    <link href="http://rich.k3r.me/blog/2015/01/31/casual-gaming/"/>
    <updated>2015-01-31T10:26:17+00:00</updated>
    <id>http://rich.k3r.me/blog/2015/01/31/casual-gaming</id>
    <content type="html"><![CDATA[<p>To say I am a casual gamer is probably overstating my position, but I do like a bit of inflight entertainment during a &ldquo;comfort break&rdquo;. This is a list of games I enjoy playing on the iPhone.</p>

<!--more-->


<p><img class="centre" src="http://rich.k3r.me/images/games/shades.png" width="175" height="175" title="Shades iOS Game Icon" ></p>

<h2><a href="https://itunes.apple.com/gb/app/shades-a-simple-puzzle-game/id888683802?mt=8">Shades</a></h2>

<p>This is a new find for me and I love it. On first appearances, it&rsquo;s a Tetris clone. Actually though, that is not a fair assessment. The game&rsquo;s clever use of shades of colour and how they merge together, makes for an addictive game, that is harder than it looks! I think I&rsquo;ve managed to get to level 9 so far.</p>

<p><img class="centre" src="http://rich.k3r.me/images/games/monument.jpg" width="175" height="233" title="Monument Valley iOS Game Screenshot" ></p>

<h2><a href="http://appstore.com/monumentvalley">Monument Valley</a></h2>

<p>Probably the best puzzle game I&rsquo;ve ever played, certainly the most beautiful (of any genre). The game plays on the complexity of Escher style architecture. I completed the game and the two expansions without too much difficulty, that shouldn&rsquo;t put you off though. It&rsquo;s a game that can replayed over and over and the experience is absorbing.</p>

<iframe src="//player.vimeo.com/video/5892502" width="500" height="375" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>


<h2><a href="itms://itunes.com/apps/osmos">Osmos</a></h2>

<p>It&rsquo;s the longest standing (memorable) iOS game I have, actually on my iPad, but it is also available for iPhone. Also the first game that I installed that actively encourages the use of headphones to enhance the experience. I love Osmos; it&rsquo;s an incredibly relaxing game to play. The difficulty of levels varies greatly. I&rsquo;ve not managed to complete the game so far, but I play it more out relaxation than out of a need to push through to the upper levels.</p>

<p><img class="centre" src="http://rich.k3r.me/images/games/badland.jpg" width="248" height="175" title="Badland iOS Game Screenshot" ></p>

<h2><a href="https://itunes.apple.com/us/app/badland/id535176909?mt=8&amp;uo=4">Badland</a></h2>

<p>It seems to me that when everyone was getting excited about Flappy Bird, what they should have been playing is Badland. The idea of keeping the main character up by tapping isn&rsquo;t a new one. I remember playing games of a similar vein on the Commodore 64 (struggling to remember the name though). Badland is this sort of game, but the obstacles can be tricky and timing is key. The graphics and soundtrack really work for me in playfully steampunk-y sort of way.</p>

<p><img class="centre" src="http://rich.k3r.me/images/games/crossy-road.png" width="175" height="310" title="Crossy Road iOS Game Screenshot" ></p>

<h2><a href="https://itunes.apple.com/app/crossy-road-endless-arcade/id924373886?at=1l3vs3u&amp;ct=crcom">Crossy Road</a></h2>

<p>My kids introduced me to this one. Cue yet another eye-roll of something that the kids thought they had found, that our generation owned. &ldquo;It&rsquo;s <a href="http://en.wikipedia.org/wiki/Frogger">Frogger</a>!&rdquo; I exclaimed. &ldquo;I played this when I was your age&rdquo;, with a smug curl to my lip. I received blank expressions to this reaction, as I usually do when I attempt some sort of generational dominance. The point of Crossy Road, is that it is completely gorgeous to look at. I loved Frogger, now I get to play it on my iPhone with sensational graphics.</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/2N1TJP1cxmo" frameborder="0" allowfullscreen></iframe>


<h2><a href="http://www.mirrorsedge.com/">Mirror&rsquo;s Edge</a></h2>

<p>I can&rsquo;t believe that this game is no longer available on the App Store! What the eff! This game has single handedly taken more hours of my life than any other game. The multiplayer modes are brilliant, I love playing against my kids on them. The purpose of the game is to get from A to B using the Parkour style. I can only hope that a new one is not far off.</p>

<h2>Honourable Mentions</h2>

<p>Oh man, I really want to get this post wrapped up, but I can&rsquo;t without mentioning two (well, three) more games.</p>

<h3>N.O.V.A 2&amp;3</h3>

<p>I don&rsquo;t own a console capable of playing Halo. I&rsquo;m not a big console sort of person, but I do love Halo. N.O.V.A 2 was the closest I could find to the experience on an iPhone. It&rsquo;s a great game that my kids and I regularly team up on. Well, we used too, until N.O.V.A 3 came out. #3 was initially quite frustrating, because the multiplayer maps are just so vast, we&rsquo;d spend the whole game just trying to find each other. We&rsquo;re better now and the game can be a great afternoon of destruction.</p>

<h3>Modern Combat 5</h3>

<p>A sort of progression on from N.O.V.A. I hope N.O.V.A isn&rsquo;t dropped because of the popularity of games like Modern Combat, but even so, MC5 is aces. I&rsquo;ve completed the solo missions. I&rsquo;m an absolute disaster at the multiplayer missions though.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Shutting the World Out]]></title>
    <link href="http://rich.k3r.me/blog/2015/01/22/shutting-the-world-out/"/>
    <updated>2015-01-22T20:18:34+00:00</updated>
    <id>http://rich.k3r.me/blog/2015/01/22/shutting-the-world-out</id>
    <content type="html"><![CDATA[<p>There is never enough time. Last year in particular, it always felt like there wasn&rsquo;t enough time in the day.  Running a company, where your work is also the primary source of income, is no easy task. I was always looking for ways of squeezing more hours out of day; tweaking processes, finding better tools, writing scripts. It&rsquo;s become a bit of an obsession for me, finding &ldquo;better&rdquo; ways to get more stuff done. I was pretty good at it, I think I still am. But as the end of last year drew in, it became clear that I was spreading myself too thin.</p>

<!--more-->


<p>I was a manager, a sales person, a support desk, a developer, and was switching these hats constantly throughout the day. My goal on any given day, was to get to the end of the day without any major mishaps. If I managed to progress at all, in terms of significant progression of a project or a more efficient way of doing something, well that was amazing.</p>

<p>The problem was concentration, I couldn&rsquo;t stay focused on a single task, without being distracted by someone or something craving my attention. We experimented with a few different ways of tackling this:</p>

<ol>
<li>Switching off access to email at specific parts of the day.</li>
<li>We decided that I should not answer the phone.</li>
<li>Further than this, I wouldn&rsquo;t participate in a phone call unless it was me that initiated it. If someone wanted to talk to me, a time would be arranged for me to ring them back.</li>
<li>Allocated time to perform specific tasks.</li>
</ol>


<p>These feel obvious to me now, but they weren&rsquo;t back then and had a huge impact on my ability to get through work. Even combined though, these were not the silver bullets I was after. I&rsquo;m too nosey for one thing, if someone else picked up the phone, my ears would prick up, brain on overdrive wondering what they wanted and were the requirements being dealt with correctly. And who can blame me, it&rsquo;s my company after all.</p>

<p>I needed a way of maintaining concentration, without completely removing myself from the office. My salvation came in another, now startlingly obvious, epiphany; headphones. It&rsquo;d never really occurred to me in the past to try headphones, because in the past I&rsquo;ve typically opted for in-ear earphones, which are uncomfortable over long periods of time. I&rsquo;m also pretty negative on headphones in an office environment as rule, because I hate sound leakage. But I didn&rsquo;t see that I had an option and it&rsquo;s made the world of difference. <a href="http://rich.k3r.me/blog/2015/01/20/finding-a-pair-of-headphones/">My earphones</a> use noise reduction to completely immerse me in the task at hand.</p>

<p>An unexpected and corny side effect of the headphones has been trust. I am nosey because I believe I need to be involved in every decision, that my opinion always needs to be considered. Switching on the headphones has demonstrated to me that  I&rsquo;m not (always) the centre of the universe, and that many facets of the company can run without my constant interference.</p>

<p>I&rsquo;m okay with that, because I spend a lot more time on the stuff I like doing now.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RailsInstaller (Ruby 2.1) on Windows 8.1]]></title>
    <link href="http://rich.k3r.me/blog/2015/01/22/railsinstaller-ruby-2-dot-1-on-windows-8-dot-1/"/>
    <updated>2015-01-22T19:53:44+00:00</updated>
    <id>http://rich.k3r.me/blog/2015/01/22/railsinstaller-ruby-2-dot-1-on-windows-8-dot-1</id>
    <content type="html"><![CDATA[<p>I&rsquo;ve recently had to get Rails and Capistrano up and running on a Windows 8.1 machine. These are the problems I encountered and how I fixed them. All issues were encountered after trying to run an existing Rails 4 project.</p>

<!--more-->


<p>My first step was to install Rails using <a href="http://railsinstaller.org">RailsInstaller</a>. This is a great first step for Windows users, as you also get Ruby, Git and DevKit (which is important for building gems that contain native code). I elected to install the Ruby 2.1 version, which at the time of install, was sporting Ruby 2.1.5.</p>

<h2>Invalid Certificate</h2>

<p>When running <code>bundle</code>, I encountered the following error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'>Unable to download data from https:<span class="n">//rubygems.org/</span> - SSL_connect returned<span class="o">=</span><span class="m">1</span> errno<span class="o">=</span><span class="m">0</span> state<span class="o">=</span>SSLv<span class="m">3</span>
</span></code></pre></td></tr></table></div></figure>


<p>As per the accepted answer on this <a href="http://stackoverflow.com/questions/27435841/windows-7-64-bit-could-not-find-a-valid-gem-compass-0-here-is-why-unab">StackOverflow question</a>, I downloaded <a href="http://curl.haxx.se/ca/cacert.pem">cacert.pem</a> and placed it here, C:\RailsInstaller. You also need to tell <code>gem</code> where to find the certificate, which is done by setting a environment variable called <code>SSL_CERT_FILE</code>. This can be done on a temporary basis by typing the following into Command Prompt&#8221;:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'><span class="k">set</span> <span class="nv">SSL_CERT_FILE</span><span class="o">=</span>C:\RailsInstaller\cacert.pem
</span></code></pre></td></tr></table></div></figure>


<h2>Sqlite Native</h2>

<p>Running any command related to the local Sqlite db, threw up:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'>cannot load such file -- sqlite<span class="m">3</span><span class="n">/sqlite3_native</span>
</span></code></pre></td></tr></table></div></figure>


<p>According to this <a href="http://stackoverflow.com/questions/26636471/windows-ruby-rails-install-cannot-load-such-file-sqlite3-sqlite3-native">accepted answer</a>, the problem is caused by the version of the <code>sqlite3</code> gem not supporting Ruby 2.1.3+ on Windows. The gem needed to be updated to at least 1.3.10.</p>

<h2>Bcrypt</h2>

<p>I encountered a similar problem with the <code>bcrypt</code> gem. I didn&rsquo;t record the nature of the problem, but updating to at least 3.1.7 resolved the issue.</p>

<h2>TZInfo</h2>

<p>When starting up the Rails server, I received an error relating to <code>TZInfo::DataSourceNotFound</code>. According to the accepted answer on this <a href="http://stackoverflow.com/questions/23022258/tzinfodatasourcenotfound-error-starting-rails-v4-1-0-server-on-windows">question</a>, Windows needs an additional gem for the <code>tzinfo</code> gem to work correctly. Add this to your <code>Gemfile</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;tzinfo-data&#39;</span><span class="p">,</span> <span class="ss">platforms</span><span class="p">:</span> <span class="o">[</span><span class="ss">:mingw</span><span class="p">,</span> <span class="ss">:mswin</span><span class="p">,</span> <span class="ss">:x64_mingw</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<h2>NPM Error</h2>

<p>For bonus points, I always install Node along with my Rails installations, if only for JavaScript compilation in Sprockets. Node is best installed using the binary from the official <a href="http://nodejs.org/">website</a>.</p>

<p>Typing <code>npm</code> into Command Prompt for the first time, returned the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'>Error: ENOENT<span class="p">,</span> stat &#39;C:\Users\[Username Here]\AppData\Roaming\npm
</span></code></pre></td></tr></table></div></figure>


<p>This issue was resolved by creating the missing <code>npm</code> folder in <code>Roaming</code>. Credit goes to the accepted answer of this <a href="http://stackoverflow.com/questions/25093276/node-js-windows-error-enoent-stat-c-users-rt-appdata-roaming-npm">question</a>.</p>

<h2>Capistrano</h2>

<p>On the first day of setup, Capistrano worked like a dream. The following day, after a system restart, no dice. Capistrano tasks kept dying with the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'>Error reading response length from authentication socket
</span></code></pre></td></tr></table></div></figure>


<p>I tried reinstalling certificates and ensured the SSH Agent was running, to no avail. I still don&rsquo;t completely understand the problem, but I think the solution has more to do with the PC&rsquo;s specific environment.</p>

<p><a href="http://www.sourcetreeapp.com/">SourceTree</a> was already installed (and running) on the PC, when I came to install Rails. As part of the installation, SourceTree installs <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">Pageant</a>, a Windows based SSH authentication tool.</p>

<p>Basically, Capistrano started working again the moment I had the presence of mind to start Pageant again.</p>

<p><em>NOTE: The PC has two sets of SSH keys setup, one through Pageant, the other through <a href="https://msysgit.github.io/">Msysgit</a>. I thought I&rsquo;d been using the Msysgit key, but I suspect I was using the Pageant one all along. For Capistrano at least, Git works from the command line, regardless of the status of Pageant.</em></p>

<p>I&rsquo;m not aware of any dependancy on Pageant by RailsInstaller. So I wonder whether I wouldn&rsquo;t have this dependancy now, if I didn&rsquo;t already have Pageant on the system. Or possibly, I&rsquo;d have struggled getting Capistrano working at all, not appreciating the need for Pageant.</p>

<h2>Line Endings</h2>

<p>I&rsquo;m still not 100% clear what happened here. We manage a number of GIT repos on Windows &amp; Mac, and have not had this issue before. Upon committing changes to a project, from the Windows machine, all the line endings were converted to CRLF. This caused problems with Rake. My inital attempts to fix the issue on a Mac resulted in me corrupting the Sqlite3 development database, so for the remainder of this fix, assume I&rsquo;ve temporarily moved the db (along with all other binary files, i.e. images) out of the directory structure.</p>

<p>From the project root, on a Mac, I ran the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>find . -type f -not -path <span class="s2">&quot;./.git/*&quot;</span> -exec perl -pi -e <span class="s1">&#39;s/\r\n|\n|\r/\n/g&#39;</span> <span class="o">{}</span> <span class="se">\;</span>
</span></code></pre></td></tr></table></div></figure>


<p>From Linux, you can run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>find . -type f -not -path <span class="s2">&quot;./.git/*&quot;</span> -exec dos2unix <span class="o">{}</span> <span class="se">\;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above, replaces CRLF with LF for all files in the GIT repo.</p>

<p>After readding the database, I ran <code>rails server</code> to check for obvious issues; all seemed well. As per this <a href="https://help.github.com/articles/dealing-with-line-endings/#platform-windows">Github article</a>, I ran the following on the Windows machine:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'>git config --global core.autocrlf true
</span></code></pre></td></tr></table></div></figure>


<p>The above, gets GIT to manage line endings on Windows machines, to keep them in sync with GIT&rsquo;s base line ending (LF).</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Finding a Pair of Headphones]]></title>
    <link href="http://rich.k3r.me/blog/2015/01/20/finding-a-pair-of-headphones/"/>
    <updated>2015-01-20T22:38:34+00:00</updated>
    <id>http://rich.k3r.me/blog/2015/01/20/finding-a-pair-of-headphones</id>
    <content type="html"><![CDATA[<p>When looking for a pair of headphones, it was important to me that they shut out as much outside noise as possible and be comfortable for long periods of time. I&rsquo;ve never spent more than £15 on a pair of earphones (typically in ear), so when you type in those requirements into a search engine, you should expect quite a shock!</p>

<!--more-->


<p>I&rsquo;d read on a couple of developer blogs, that &ldquo;around ear&rdquo; design was the way to go for comfort. Also, that <a href="http://www.audio-technica.com/cms/headphones/99aff89488ddd6b1/">Audio Technica ATH-M50X</a>s were a good choice for the money, at around £100. I&rsquo;m a long time fan of Sennheiser, and came across the <a href="http://en-uk.sennheiser.com/over-ear-headphone-momentum-stereo">Momentum</a> range under my own steam. The &ldquo;around ear&rdquo; Momentum&rsquo;s are around £200 and are far and away the most gorgeous looking headphones I&rsquo;ve ever seen.</p>

<p>Feeling out of my depth though, I asked around a couple of friends. The response was unanimous. If you want to block out sound, it has to be the Bose Quiet Comfort range. The <a href="https://www.bose.co.uk/GB/en/home-and-personal-audio/headphones-and-headsets/acoustic-noise-cancelling-headphones/quietcomfort-25-headphones/">QC25</a> model is the latest and cost £270! Holy floor Batman, that was not going to be an off-the-cuff decision!</p>

<p>What makes a pair of headphones cost almost £300? The QC25 has acoustic noise cancellation, which I think is basically a series of microphones that detect outside noise, which the headphone then counteracts with a reverse wave, cancelling out the sound. It sounds cool, but I was also concerned the cancelation might work against me, I&rsquo;m quiet sensitive to electrical noise.</p>

<p>Working on the assumption that Bose aren&rsquo;t the only company capable of such feats, I also found the <a href="http://en-uk.sennheiser.com/wireless-bluetooth-headset-stereo-mm-550-x-travel">Sennheiser MM 550-X</a>, which purport to do the same as the QC25s, but with bluetooth and surround sound for the same price! At this point the prices were more like monopoly money in my head.</p>

<p>I&rsquo;d seen these headphones online, but no way was I going to spend dollar until I&rsquo;d tried them on! I set out to two city centres and a shopping centre, where I found two Bose shops and a third shop that only had Bose headphones for you to try. Not a snifter of the other headphones!</p>

<p>The QC25s were incredible! The sound was beautiful and crisp. In the busy shopping centre, I switched the noise reduction on and the world slipped away. Wow. The &ldquo;anti sound&rdquo; wasn&rsquo;t noticeable to me in the shopping centre.</p>

<p>I wanted to make sure I was making the right choice though, so I hit the internet reviews. I needed noise reduction now, I wasn&rsquo;t going to spend a £100 on a pair of earphones that didn&rsquo;t disconnect me from the world. So the question was, how good are the MM 550-Xs? Even the most glowing review of these headphones, that cited them as the best bluetooth headphones on the market, suggested that surround sound was best turned off and the noise reduction was not on par with the QC25. I was really attracted to the bluetooth, but noise reduction was becoming very important to me.</p>

<p>Fast forward a lot &ldquo;first world&rdquo; agonising and several attempts to find a shop that would allow me to try a decent selection of headphones. I conceded though and bought the QC25s.</p>

<p>In the silence of my home, I was initially stuck by two disappointments:</p>

<ol>
<li>The &ldquo;anti noise&rdquo; is audible if you&rsquo;re in a quiet environment. To me at least.</li>
<li>The headphones leak more noise to the outside than I&rsquo;d like at moderate volumes.</li>
</ol>


<p>Then I told myself to get a grip. Why would you use the noise reduction in a quiet environment any way. The headphones do leak more noise than I&rsquo;d like, but I am exceptionally picky in this area.</p>

<p>I&rsquo;ve been using them for about two weeks now and I&rsquo;m entirely satisfied. At work I am blissful ignorance to the world around me. At home, Gravity Rush on the PS Vita is a completely new experience with these bad boys on.</p>

<p>I cannot overstate how comfy they are to wear and the case is invaluable as I am always lugging stuff around in my man bag.</p>

<p>I still have reservations over spending that amount of money on a pair of headphones, but the headphones themselves, I&rsquo;m doubtless are worth every penny.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Flexible Index Pages in Perch]]></title>
    <link href="http://rich.k3r.me/blog/2015/01/14/flexible-index-pages-in-perch/"/>
    <updated>2015-01-14T23:14:12+00:00</updated>
    <id>http://rich.k3r.me/blog/2015/01/14/flexible-index-pages-in-perch</id>
    <content type="html"><![CDATA[<p>It&rsquo;s pretty easy to knock up an index page in Perch. By &lsquo;index page&rsquo;, I mean a page that summarises the content of a sub folder. For instance, you have a collection of projects, implemented as sub pages of a directory called &lsquo;projects&rsquo;. You could provide a link to each of these projects on an index page.</p>

<!--more-->


<p>The typical structure would be:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root
</span><span class='line'>  projects
</span><span class='line'>      index.php
</span><span class='line'>      project-1.php
</span><span class='line'>      project-2.php</span></code></pre></td></tr></table></div></figure>


<p>The index itself would be provided by the <code>perch_pages_navigation</code> function. A basic example below:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span> <span class="nx">perch_pages_navigation</span><span class="p">(</span><span class="k">array</span><span class="p">(</span> <span class="s1">&#39;from-path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;*&#39;</span> <span class="p">));</span> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p><em>The asterisk assigned to <code>from-path</code> tells <code>perch_pages_navigation</code> to work from the current directory (&lsquo;projects&rsquo;).</em></p>

<p><em>More information on <code>perch_pages_navigation</code> can be found here, <a href="http://docs.grabaperch.com/docs/navigation/perch-pages-navigation/">perch_pages_navigation</a>.</em></p>

<p>Would output:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ul&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/projects/project-1.php&quot;</span><span class="nt">&gt;</span>Project 1<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/projects/project-2.php&quot;</span><span class="nt">&gt;</span>Project 2<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/li&gt;</span>
</span><span class='line'><span class="nt">&lt;/ul&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>perch_pages_navigation</code> function uses the HTML template &lsquo;perch/templates/navigation/item.html&rsquo; to generate the HTML above. This is a file that can be modified, or even replaced using the <code>template</code> option.</p>

<p>You&rsquo;re restricted in the content that can be displayed in this template. This is because of how data in Perch is grouped. Within a <code>perch_pages_navigation</code> template, you have access to data related to the page, like the title and path. But you don&rsquo;t have access to content regions, defined using <code>perch_content</code>, as this not information that is shared across all pages.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>Page Content
</span><span class='line'>  - pagePath <span class="nt">&lt;--</span> <span class="na">Can</span> <span class="na">access</span> <span class="na">this</span>
</span><span class='line'>  <span class="na">Region</span> <span class="na">Content</span> <span class="err">(</span><span class="na">as</span> <span class="na">defined</span> <span class="na">in</span> <span class="na">a</span> <span class="na">perch_content</span> <span class="na">region</span><span class="err">)</span>
</span><span class='line'>      <span class="na">-</span> <span class="na">some_content</span> <span class="err">&lt;</span><span class="na">--</span> <span class="na">Can</span><span class="err">&#39;</span><span class="na">t</span> <span class="na">access</span> <span class="na">this</span>
</span></code></pre></td></tr></table></div></figure>


<p>As of Perch 2.4, you can extend the amount content saved at a page level, using <a href="http://rich.k3r.me/blog/2015/02/18/page-attributes-in-perch/">Page Attributes</a>. Page Attributes can be very useful, but they can&rsquo;t be used to be target a sub-sect of pages (like our project pages), so are not ideal for what we&rsquo;re trying to achieve. I.E You can only add fields that will be available to all pages.</p>

<p><em>Update: This is not entirely true. You can set an &lsquo;Attribute template&rsquo; per page, in &lsquo;Page Options&rsquo;. Attribute templates allow you to decide which attributes are configurable at a page level. There is a draw back back though; the &lsquo;Attribute template&rsquo; is not saved in a Master page. So it would be down to the user to configure the &lsquo;Attribute template&rsquo; each page. Checkout my post of Page Attributes <a href="http://rich.k3r.me/blog/2015/02/18/page-attributes-in-perch/">here</a>.</em></p>

<p>What is needed is a mechanism, whereby the page order is retrieved from the Navigation part of Perch and the content, from a region designed with our projects in mind.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>      <span class="nv">$nav</span> <span class="o">=</span> <span class="nx">perch_pages_navigation</span><span class="p">(</span><span class="k">array</span><span class="p">(</span> <span class="c1">// Return navigation pages data as array</span>
</span><span class='line'>          <span class="s1">&#39;from-path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;skip-template&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
</span><span class='line'>          <span class="p">));</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">foreach</span><span class="p">(</span><span class="nv">$nav</span> <span class="k">as</span> <span class="nv">$page</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Loop through &amp; customise each item returned in the array</span>
</span><span class='line'>          <span class="nx">PerchSystem</span><span class="o">::</span><span class="na">set_var</span><span class="p">(</span><span class="s1">&#39;pageNavText&#39;</span><span class="p">,</span> <span class="nv">$page</span><span class="p">[</span><span class="s1">&#39;pageNavText&#39;</span><span class="p">]);</span> <span class="c1">// Grab the page title</span>
</span><span class='line'>          <span class="nx">PerchSystem</span><span class="o">::</span><span class="na">set_var</span><span class="p">(</span><span class="s1">&#39;pagePath&#39;</span><span class="p">,</span> <span class="nv">$page</span><span class="p">[</span><span class="s1">&#39;pagePath&#39;</span><span class="p">]);</span> <span class="c1">// Find the correct links for each page</span>
</span><span class='line'>          <span class="nx">perch_content_custom</span><span class="p">(</span><span class="s1">&#39;Detail&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span> <span class="c1">// &#39;Detail&#39; is the region containing the data we need - this is used in the target page template</span>
</span><span class='line'>              <span class="s1">&#39;page&#39;</span> <span class="o">=&gt;</span> <span class="nv">$page</span><span class="p">[</span><span class="s1">&#39;pagePath&#39;</span><span class="p">],</span> <span class="c1">// The dynamic path to the page which contains the target region</span>
</span><span class='line'>              <span class="s1">&#39;template&#39;</span> <span class="o">=&gt;</span><span class="s1">&#39;project_item.html&#39;</span> <span class="c1">// This region reuses data from target pages (image, excerpt)</span>
</span><span class='line'>          <span class="p">));</span>
</span><span class='line'>
</span><span class='line'>          <span class="nv">$i</span> <span class="o">=</span> <span class="nv">$i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;/ul&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The PHP above retrieves our list of pages using <code>perch_pages_navigation</code>, but this time skipping the template. Setting <code>skip-template</code> to <code>true</code>, bypasses the HTML rendering process and returns an array instead. The array itself is a list of all our project pages, including associated page data.</p>

<p>With the array in hand, we can apply it to a standard content region, allowing us to access project specific content. Within the <code>foreach</code> loop, we grab what we need from the page data (in this case <code>pagePath</code> and <code>pageNavText</code>). We&rsquo;ll need the <code>pagePath</code> value for two reasons; we&rsquo;ll need to know where we&rsquo;re linking too, but also we can use <code>pagePath</code> to summon up our project specific content.</p>

<p>See this line below, it&rsquo;s instructing <code>perch_content_custom</code> to go to the project page for the content to populate our template (&lsquo;project_item.html&rsquo;).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="s1">&#39;page&#39;</span> <span class="o">=&gt;</span> <span class="nv">$page</span><span class="p">[</span><span class="s1">&#39;pagePath&#39;</span><span class="p">],</span> <span class="c1">// The dynamic path to the page which contains the target region</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s really powerful, but I&rsquo;ve skipped two things:</p>

<ol>
<li>What does the &lsquo;Detail&rsquo; region of the project page look like?</li>
<li>What does &lsquo;project_item.html&rsquo; look like?</li>
</ol>


<p>Where possible I tend to organise my page templates into as few content regions as possible, the primary region typically being called &lsquo;Detail&rsquo;.</p>

<p>Let&rsquo;s assume we&rsquo;re project title is being inferred from the page title. Below is the Detail region (&lsquo;project_detail.html&rsquo;), which includes a description, an image and a list of features.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;desc&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;perch:content</span> <span class="na">id=</span><span class="s">&quot;desc&quot;</span> <span class="na">type=</span><span class="s">&quot;textarea&quot;</span> <span class="na">label=</span><span class="s">&quot;Description&quot;</span> <span class="na">html=</span><span class="s">&quot;true&quot;</span> <span class="na">editor=</span><span class="s">&quot;ckeditor&quot;</span> <span class="na">imagewidth=</span><span class="s">&quot;640&quot;</span> <span class="na">imageheight=</span><span class="s">&quot;480&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two-col&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;image&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;&lt;perch:content type=&quot;</span><span class="na">image</span><span class="err">&quot;</span> <span class="na">id=</span><span class="s">&quot;image&quot;</span> <span class="na">label=</span><span class="s">&quot;Image&quot;</span> <span class="na">width=</span><span class="s">&quot;800&quot;</span> <span class="nt">/&gt;</span>&quot; alt=&quot;<span class="nt">&lt;perch:content</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;alt&quot;</span> <span class="na">label=</span><span class="s">&quot;Description&quot;</span> <span class="na">required=</span><span class="s">&quot;true&quot;</span> <span class="na">help=</span><span class="s">&quot;e.g. Photo of MD John Smith with his best wig on&quot;</span> <span class="na">title=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>&quot; /&gt;
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;feat&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>          <span class="nt">&lt;perch:repeater</span> <span class="na">id=</span><span class="s">&quot;features&quot;</span> <span class="na">label=</span><span class="s">&quot;Features&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>              <span class="nt">&lt;li&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;perch:content</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;feature&quot;</span> <span class="na">label=</span><span class="s">&quot;Feature&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/perch:repeater&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>Since the inclusion of <a href="http://docs.grabaperch.com/docs/templates/repeaters/">Repeaters</a> within content templates, it&rsquo;s become much easier to create self contained content regions. Before repeaters, the moment you hit an image gallery or feature list, you&rsquo;d need to duck out of your primary content region and create a new repeating content region. Leading to fun naming conventions like &lsquo;Detail - Top&rsquo; and &lsquo;Detail - Bottom&rsquo;, with &lsquo;Feature List&rsquo; stuck in the middle.</em></p>

<p>We&rsquo;ll need to some an additional fields to &lsquo;project_detail.html&rsquo;,for us to access in the index page, a thumbnail and an excerpt:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;perch:content</span> <span class="na">id=</span><span class="s">&quot;thumbnail&quot;</span> <span class="na">type=</span><span class="s">&quot;image&quot;</span> <span class="na">label=</span><span class="s">&quot;Thumbnail&quot;</span> <span class="na">width=</span><span class="s">&quot;310&quot;</span> <span class="na">height=</span><span class="s">&quot;160&quot;</span> <span class="na">crop=</span><span class="s">&quot;true&quot;</span> <span class="na">required=</span><span class="s">&quot;true&quot;</span> <span class="na">help=</span><span class="s">&quot;Recommended image size: 310px wide &amp; 160px high&quot;</span> <span class="na">suppress=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;perch:content</span> <span class="na">id=</span><span class="s">&quot;excerpt&quot;</span> <span class="na">type=</span><span class="s">&quot;textarea&quot;</span> <span class="na">label=</span><span class="s">&quot;Excerpt&quot;</span> <span class="na">html=</span><span class="s">&quot;false&quot;</span> <span class="na">imagewidth=</span><span class="s">&quot;640&quot;</span> <span class="na">imageheight=</span><span class="s">&quot;480&quot;</span> <span class="na">suppress=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Both fields have <code>suppress</code> set to <code>true</code>, meaning that they fields available for input, but will not appear in the resulting HTML for the template. We want the use to be able to enter an excerpt, but we don&rsquo;t want the except to appear on the detail page.</p>

<p>So, what does &lsquo;project_item.html&rsquo; look like? You can see it below:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;article&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h2&gt;</span>
</span><span class='line'>      <span class="nt">&lt;perch:content</span> <span class="na">id=</span><span class="s">&quot;pageNavText&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;project-thumb&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;&lt;perch:content id=&quot;</span><span class="na">thumbnail</span><span class="err">&quot;</span> <span class="na">type=</span><span class="s">&quot;image&quot;</span> <span class="na">width=</span><span class="s">&quot;310&quot;</span> <span class="na">height=</span><span class="s">&quot;160&quot;</span> <span class="na">crop=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>&quot; alt=&quot;&quot; class=&quot;img-responsive&quot; /&gt;
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;project-detail&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;excerpt&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;p&gt;</span>
</span><span class='line'>              <span class="nt">&lt;perch:content</span> <span class="na">id=</span><span class="s">&quot;excerpt&quot;</span> <span class="na">type=</span><span class="s">&quot;textarea&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>          
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&lt;perch:content id=&quot;</span><span class="na">pagePath</span><span class="err">&quot;</span> <span class="nt">/&gt;</span>&quot;&gt;
</span><span class='line'>          VIEW CASE STUDY
</span><span class='line'>      <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/article&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The title is inferred from the <code>pageNavText</code> variable (set in the <code>foreach</code> loop), likewise the url comes from <code>pagePath</code>. The thumbnail and the except are retrieved using standard Perch content tags, as it is after all content being rendered using <code>perch_content_custom</code>.</p>

<p>Your resulting index page will look something like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;article&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h2&gt;</span>
</span><span class='line'>      Project 1
</span><span class='line'>  <span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;project-thumb&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;/images/project-1.jpg&quot;</span> <span class="na">alt=</span><span class="s">&quot;&quot;</span> <span class="na">class=</span><span class="s">&quot;img-responsive&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;project-detail&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;excerpt&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;p&gt;</span>
</span><span class='line'>              Project excerpt
</span><span class='line'>          <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>          
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/projects/project-1.php&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          VIEW CASE STUDY
</span><span class='line'>      <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/article&gt;</span>
</span><span class='line'><span class="nt">&lt;article&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h2&gt;</span>
</span><span class='line'>      Project 2
</span><span class='line'>  <span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;project-thumb&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;/images/project-2.jpg&quot;</span> <span class="na">alt=</span><span class="s">&quot;&quot;</span> <span class="na">class=</span><span class="s">&quot;img-responsive&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;project-detail&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;excerpt&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;p&gt;</span>
</span><span class='line'>              Project 2 excerpt
</span><span class='line'>          <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>          
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/projects/project-2.php&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          VIEW CASE STUDY
</span><span class='line'>      <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/article&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see above, we now have an index page with links to the sub pages, including a brief excerpt and a thumbnail for each.</p>

<p>The advantages of this solution are:</p>

<ol>
<li>Because the solution uses  <code>perch_pages_navigation</code>, the page will honour Perch&rsquo;s ordering functionality.</li>
<li>The use of <code>perch_content_custom</code> means that we can create fields specifically for use in project pages, that don&rsquo;t bloat the page data of non project pages.</li>
</ol>


<p>The problem with the solution, is that multiple calls to the database are required to display the list. One to retrieve the navigation list, and then an additional call for each of the pages returned.</p>

<p>A solution that reduced the amount of database calls, while still harnessed the power of the Perch templating system, might to write a SQL statement manually, the joined the navigation <code>SELECT</code> statement to a statement retrieving the desired content data, then parsed each of the results through the templating system. This might be something I investigate, should the volume of sub pages, demonstrate a noticeable slowdown of load time.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The Funniest Men of All Time - Rebuttal]]></title>
    <link href="http://rich.k3r.me/blog/2015/01/13/the-funniest-men-of-all-time-rebuttal/"/>
    <updated>2015-01-13T17:20:21+00:00</updated>
    <id>http://rich.k3r.me/blog/2015/01/13/the-funniest-men-of-all-time-rebuttal</id>
    <content type="html"><![CDATA[<p>When I saw the post <a href="http://thechive.com/2015/01/03/the-funniest-men-of-all-time-15-photos/">The funniest men of all time</a> pop up on my feed the other day, I was interested to see the awesome caliber of comic genius that would appear on such a strongly titled list.</p>

<!--more-->


<p><em>I think we can all safely assume going into this post, that the use of the word &lsquo;men&rsquo; is used strictly in the non-specific gender meaning of the word. Definitely.</em></p>

<p>Well that was weird. Let me take you through thought process, step by step:</p>

<ol>
<li>I don&rsquo;t know who half these people are.</li>
<li>After some research, they all appear to be North American.</li>
<li>I suspect, this is not a definitive list and heavily biased towards an american audience.</li>
<li>Richard Pryor would definitely make my list.</li>
<li>I&rsquo;m gonna make a list.</li>
<li>Aren&rsquo;t there any funny North American women?</li>
<li>I&rsquo;m sure there is, I just can&rsquo;t think of their names at the moment.</li>
</ol>


<p>With my brain stuck on point 5, my own list must be heard! So my, nay THE list of funnest <del>men</del> humans of ALL TIME, with every chance that it may or may not be factually accurate, is:</p>

<h2>Richard Pryor</h2>

<p>The Chive got this one right, holy cow this man was funny. I first encountered Prior, as every good nerd only could have, in Superman 3.</p>

<h2>John Cleese</h2>

<p>Of all the Brits not to make any american list of funny people, it&rsquo;s John Cleese I&rsquo;m amazed was missing. He&rsquo;s done so much it&rsquo;s hard to name favourite, but I&rsquo;m going to try; Fawlty Towers. Or maybe Life of Brian.</p>

<p>Mr. Cleese also has a lot of interesting to say about creativity. He has certainly helped me look how I work creatively.</p>

<iframe width="560" height="315" src="//www.youtube.com/embed/yAwDWe7OIF8" frameborder="0" allowfullscreen></iframe>


<p><img src="" alt="" /></p>

<h2>Sarah Silverman</h2>

<p>The Sarah Silverman Show has made me cry why laughter on more than one occasion. She does a surreal, irreverent style of comedy that&hellip; I wish there was more of it. (North American funny lady)</p>

<h2>Dylan Moran</h2>

<p>I&rsquo;ve been in love with this man&rsquo;s comedy since Black Books. I like to believe it&rsquo;s actually how Dylan Moran lives his life.</p>

<h2>Dawn French</h2>

<p>Dawn French is an absolute must for this list, for so many reasons; from Comic Strip to Vicar of Dibley.</p>

<h2>Sean Lock</h2>

<p>I find Sean Lock&rsquo;s view of the world hysterical.</p>

<h2>Robin Williams</h2>

<p>He had me a Mork. I&rsquo;ve not stopped laughing since.</p>

<h2>Reginald D. Hunter</h2>

<p>I love what I perceive to be British humour, and struggle with a lot of &lsquo;established&rsquo; American comedians. Reginald D. Hunter just seems to get it.</p>

<h2>Morecambe &amp; Wise</h2>

<p>Is it fair to have a double act? If this was a countdown, there&rsquo;d be my number one.</p>

<h2>Eddie Izzard</h2>

<p>He was the comedy soundtrack to my twenties. It&rsquo;s the bird flying by the plane that gets me every time.</p>

<h2>Tommy Cooper</h2>

<p>&ldquo;What&rsquo;s this?&rdquo;
&ldquo;A dead one of these.&rdquo;</p>

<p>There is a lot of pressure writing a list like this. I&rsquo;ve given up trying to find CC images for them. I don&rsquo;t know how other people do it. Billy Crystal and Bill Bailey certainly belong on the list as well, I&rsquo;m not sure why I haven&rsquo;t added them.</p>

<p>Stephen Fry, who I find immensely funny, also isn&rsquo;t on the list. A travesty.</p>

<p>I love Richard Ayoade&rsquo;s dry sense of humour. Which reminds me, Katherine Parkinson makes The IT Crowd for me.</p>

<p>I think there is actually loads of people of missed out and I&rsquo;m also uncomfortable with the lack of order. It&rsquo;s not well presented list and you probably shouldn&rsquo;t take it too seriously.</p>

<p>I also find Adam Buxton extremely funny. I hope there is a new series of Bug in the works.</p>

<p>What would your list of funny people look like? I&rsquo;d love to hear.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Half-arsed Working Techniques]]></title>
    <link href="http://rich.k3r.me/blog/2014/12/21/half-arsed-working-techniques/"/>
    <updated>2014-12-21T11:21:41+00:00</updated>
    <id>http://rich.k3r.me/blog/2014/12/21/half-arsed-working-techniques</id>
    <content type="html"><![CDATA[<h2>TL;DR</h2>

<p>&ldquo;Half-arsed&rdquo;, as in reducing possibility of getting a fat arse by working more efficiently.  It&rsquo;s a pun, I&rsquo;m funny like that.</p>

<h2>Introduction</h2>

<p>I recently watched this video <a href="http://youtu.be/uiKg6JfS658">Are You Sitting Too Much?</a> and the followup <a href="http://youtu.be/4K_ENbRgywY">9 Tips To Save Your Life</a>. Please watch them if you sit for long periods of time, they&rsquo;re not long and you learn a lot.</p>

<p>I really had no idea, which is irritating because it makes perfect sense. It makes perfect sense, because even in my ignorance, I have already seen the benefits yielded from breaking up my work. Having unwittingly lost half a stone this year, without changing my diet (next year&rsquo;s resolution).</p>

<!--more-->


<p>The tips in the second video are insightful, but didn&rsquo;t really speak to my specific situation. So, I&rsquo;ve come up with a few ideas for how I might tackle the issue.</p>

<h2>Use a Timer</h2>

<p>We use a service called <a href="https://letsfreckle.com/">Freckle</a> to track the time we spend on projects. On the Mac app at least, the timer beeps once an hour; this I believe is there to indicate that the timer is still running. It seems to me though, that it is also a great reminder to get up and stretch your legs for five minutes.</p>

<p>Now, while I adore Freckle and it&rsquo;s beautiful reporting, it is quite expensive. $49 per month for a team of five. I strive for greater efficiency, if only so one day I feel I can survive the week without Freckle. It is certainly too much to spend on a simple timer to remind you to get up and have a wander.</p>

<p>If I was without Freckle and facing this issue, I&rsquo;d recognise my personal cycles of work differ at different times during the day. That is to say, that I would be much aggrieved if I was interrupted from my work after a mere hour, first thing in the morning, but would take such a distraction as a blessing mid-afternoon. Instead, I&rsquo;d chop my day into sprints of different lengths, and set up timers accordingly. This would have the extra benefit of adding a bit more structure to my day, by understanding when I&rsquo;m more effective at longer or shorter tasks.</p>

<h2>Work Standing</h2>

<p>I&rsquo;ve long enjoyed the idea of these adjustable desks, that allow you to work seated or standing. They are very expensive though and I wonder how I would actually get on coding for long periods of time, while standing.</p>

<p>Coding aside, I think a lot of activities can benefit from standing.</p>

<h3>Catch Up Meetings</h3>

<p>The most obvious example is meetings. Quick catch up meetings have more impact when standing, the same meeting while seated would take twice as long.</p>

<h3>Phone calls</h3>

<p>I&rsquo;m a pacer on the phone, so this is an easy one for me. It can be quite distracting for others, but I&rsquo;ll get most of my steps throughout the day just by talking on the phone.</p>

<h3>Poor man&rsquo;s adjustable desk</h3>

<p>This is crazy idea I&rsquo;ve had, that I think I&rsquo;d like to trial. I don&rsquo;t think I&rsquo;d code standing up, but there is a bunch of other stuff that I would do on a computer while standing. Clearing up email, project management, or testing comes to mind.</p>

<p>The premise of my idea is that my development work requires a beast of a machine, but other tasks may not. I&rsquo;d have two desks, or at least have access to a second.</p>

<h4>Desk One</h4>

<p>Desk One, as it has always been, comfy with massive computer in front of me.</p>

<h4>Desk Two</h4>

<p>More like a shelf or a &ldquo;hot desking&rdquo; coffee shop table at standing height, with an inexpensive laptop (like a Chromebook) setup.</p>

<p>Every time you want to perform an admin task, you get up and walk to your admin shelf. It really doesn&rsquo;t need to be much more than that, if you&rsquo;re going to start leaning, you&rsquo;re using the space for the wrong task.</p>

<h2>Conclusion</h2>

<p>I&rsquo;m really excited about setting up sprints. I like that I&rsquo;d be able communicate clearer expectations of when I&rsquo;m approachable to my co-workers, after understanding my own process more clearly.</p>

<p>I&rsquo;m also falling in love with the idea of an admin shelf, or maybe not an admin shelf, maybe an area that is more communal. A standing desk area, that by virtue of standing there says, &ldquo;Hey I&rsquo;m approachable&rdquo;.</p>

<h2>Conclusion on Conclusion</h2>

<p>What&rsquo;s weird about my conclusion, is that it doesn&rsquo;t talk about my ideas in context of standing more; which is the point of the post. I seem to be more concerned with disruptions in my workflow and being approachable to my co-workers. I think that&rsquo;s interesting, because for me, it&rsquo;s all interconnected.</p>

<p>By playing with these techniques, I don&rsquo;t just prevent the onset of having a fat arse, I also become more productive and collaborative in my work.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Converting SVN to GIT]]></title>
    <link href="http://rich.k3r.me/blog/2012/11/25/converting-svn-to-git/"/>
    <updated>2012-11-25T20:36:00+00:00</updated>
    <id>http://rich.k3r.me/blog/2012/11/25/converting-svn-to-git</id>
    <content type="html"><![CDATA[<blockquote><p>This is a repost of <a href="http://dogma.co.uk/blog/10-converting-svn-to-git">http://dogma.co.uk/blog/10-converting-svn-to-git</a></p></blockquote>

<p>We&rsquo;ve recently set about converting all our old SVN repositories to GIT. The process is quite easy thanks to the <code>git svn</code> command, but there are some gotchas. So, I&rsquo;ll detail the process below.</p>

<p>Every revision in a SVN repository has an author, these authors need to be migrated to the new GIT repository; which is done by compiling a text file listing the existing SVN username along with the author&rsquo;s new GIT equivalent. The format of the text file is as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">svn_username</span> <span class="o">=</span> GIT User Name &lt;user@dogma.co.uk&gt;
</span></code></pre></td></tr></table></div></figure>




<!--more-->


<p>You can list as many users in this file as you like, duplicating the GIT details if required. To generate a list of the SVN author&rsquo;s run the following with the SVN repo:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>svn log --xml <span class="p">|</span> grep author <span class="p">|</span> sort -u <span class="p">|</span> perl -pe <span class="s1">&#39;s/.&gt;(.?)&lt;./$1 = /&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>A potential gotcha here is that <code>git svn</code> will fail if the SVN username has spaces in it. This caught me out as our older SVN repos were originally hosted on a Visual SVN Server, which used the username <code>Visual SVN</code>.  If you have a username with spaces in it, you must change that username in each revision the author is attached to.</p>

<p>To identify the offending revisions, run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>svn log <span class="p">|</span> sed -n <span class="s1">&#39;/svn_username/,/-----$/ p&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then to fix the username, run the following on each revision:</p>

<p>svn propedit svn:author -r revision &ndash;revprop svn_url
Once you have created an authors file (usually called authors.txt), run the following in an empty directory to clone the SVN repo into a new temporary GIT repo called <code>git-tmp</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git svn clone --stdlayout --no-metadata -A authors.txt svn_url git-tmp
</span></code></pre></td></tr></table></div></figure>


<p>Change directory into <code>git-tmp</code> and run the following to fetch the SVN repo structure:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git svn fetch
</span></code></pre></td></tr></table></div></figure>


<p>Now you&rsquo;ll want to link the temporary repository to your destination remote GIT repo, by running the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git remote add remote git_url
</span><span class='line'>git push -u remote master
</span></code></pre></td></tr></table></div></figure>


<p>The commands above will only push the master (what was trunk) to the remote repo. Currently, any branches you have in the SVN repo only exist as remote references in <code>git-tmp</code>. To make these references local branches and then push them to the server, run the following for each branch you would like to keep:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">branch</span><span class="o">=</span>branch<span class="p">;</span> <span class="nv">remote</span><span class="o">=</span>remote<span class="p">;</span> git checkout -b <span class="nv">$branch</span> remotes/<span class="nv">$branch</span><span class="p">;</span> git push -u <span class="nv">$remote</span> <span class="nv">$branch</span><span class="p">;</span> git checkout master
</span></code></pre></td></tr></table></div></figure>


<p>Providing all went well, you can now discard the temporary GIT repo and clone a fresh copy of your new remote GIT repo.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Content Management With Perch]]></title>
    <link href="http://rich.k3r.me/blog/2011/03/04/content-management-with-perch/"/>
    <updated>2011-03-04T04:22:42+00:00</updated>
    <id>http://rich.k3r.me/blog/2011/03/04/content-management-with-perch</id>
    <content type="html"><![CDATA[<blockquote><p>This is a repost of <a href="http://dogma.co.uk/blog/1-content-management-with-perch">http://dogma.co.uk/blog/1-content-management-with-perch</a></p></blockquote>

<p>Perch, if you not already aware is a curious little PHP CMS by British design agency edgeofmyseat.com.  Curious because in an ecosystem dominated by feature rich, open source, free CMSs like WordPress and Drupal; Perch provides only one feature out of the box and costs about £40 per site including VAT. Curious because given this information, I&rsquo;m still overwhelming drawn to Perch for a lot of my projects.</p>

<!--more-->


<p>Why I&rsquo;m drawn to Perch is the simplicity of the CMS itself. <a href="http://edgeofmyseat.com/">edgeofmyseat.com</a> have found niche between the handful of static HTML files in a directory and site built from the ground up to be content managed.</p>

<p>WordPress for instance, makes it very easy to create a very manageable site in minutes, literally. I dropped the folder on to my server, ran the installer and two minutes later I had a fully content managed site. Amazing, and with such a large community supporting WordPress I had customised the look, feel and function of my site with some of the thousands of free themes and plugins on offer.</p>

<p>But what about the site I already have? The individual HTML pages, strung together with anchor tags and a splash of PHP or similar as the contact form required it. Or the client who is intimidated (or just disinterested) with admin screens filled with Posts, Comments, Plugins and Tools?</p>

<p>If I was to content manage that static site with WordPress, I&rsquo;d have to extract a template from the many pages built by my predecessors and create a theme. Assuming that is the pages have retained a uniform appearance over time. Then I manually recreate each of the pages in the CMS and create (or find equivalent) plugins for all the little bits of bespoke functionality that WordPress doesn&rsquo;t quite deal with. The horrible feeling that developers get when retreading old ground.</p>

<p>Or, you install Perch. Perch is designed to let you work the way you want. You create your pages, your structure, add your images and navigation. Out of the box, Perch does one thing really well. When you&rsquo;re creating your pages and you come across section that needs to be edited by the client, drop in a content tag.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span> <span class="nx">perch_content</span><span class="p">(</span><span class="s2">&quot;Dynamic Content&quot;</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>You also need to tell Perch to watch the page; you do this by adding the following line to the top of the page:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">include</span><span class="p">(</span><span class="s2">&quot;../perch/runtime.php&quot;</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>What happens is this; when you subsequently load that page. Perch queries the database to see if it has any content for page X called &lsquo;Dynamic Content&rsquo;. If Perch doesn&rsquo;t have a content region in that location, it creates one. The next time you log into Perch, you&rsquo;ll be provided with a content region called &lsquo;Dynamic Content&rsquo; flagged as new.</p>

<p><img src="http://rich.k3r.me/images/content-manage-perch-1.png" alt="Dynamic Content" /></p>

<p>Clicking on the region gives you the opportunity to define the content type from many built-in templates ranging from text to Google Analytics to images to blocks of code. If there isn&rsquo;t a template that suits your needs, create your own. You can also decide whether the content is recurring (like a list of posts) and whether content is to be shared between multiple pages.</p>

<p>So to go back to the example of that static site. Your client just wants to change the text on the front page, or update the news feed themselves. Just add a couple of PHP tags to the desired page, set the content type in the CMS and away you go. Replicating the existing news feed is as easy as copying one of the existing news items and pasting it into a new template, replacing the content with perch tags.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;</span><span class="nx">perch</span><span class="o">:</span><span class="nx">content</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;heading&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nx">label</span><span class="o">=</span><span class="s2">&quot;Heading&quot;</span> <span class="o">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>In summary, Perch is easy to setup (install process similar to WordPress) and makes it incredibly easy to add content management to existing sites on PHP capable web servers. Perch also contains an elegant API for extending the core functionality in the form of Apps. Apps available for download from the Perch site provide blogging functionality and dynamic page creation amongst other things. Hopefully I&rsquo;ll get a chance to cover Apps and App development in another post. If you regularly deal with legacy sites or just want to simplify things a bit, I recommend you check Perch out.</p>
]]></content>
  </entry>
  
</feed>
