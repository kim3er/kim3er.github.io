
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Flexible Index Pages in Perch - Adventures in brine</title>
  <meta name="author" content="Richard Kimber">

  
  <meta name="description" content="It&rsquo;s pretty easy to knock up an index page in Perch. By &lsquo;index page&rsquo;, I mean a page that summarises the content of a sub folder. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rich.k3r.me/blog/2015/01/14/flexible-index-pages-in-perch">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Adventures in brine" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-56802309-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Adventures in brine</a></h1>
  
    <h2>A blog about code and coding.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="rich.k3r.me">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Flexible Index Pages in Perch</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-14T23:14:12+00:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:14 pm</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://rich.k3r.me">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>It&rsquo;s pretty easy to knock up an index page in Perch. By &lsquo;index page&rsquo;, I mean a page that summarises the content of a sub folder. For instance, you have a collection of projects, implemented as sub pages of a directory called &lsquo;projects&rsquo;. You could provide a link to each of these projects on an index page.</p>

<!--more-->


<p>The typical structure would be:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root
</span><span class='line'>  projects
</span><span class='line'>      index.php
</span><span class='line'>      project-1.php
</span><span class='line'>      project-2.php</span></code></pre></td></tr></table></div></figure>


<p>The index itself would be provided by the <code>perch_pages_navigation</code> function. A basic example below:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span> <span class="nx">perch_pages_navigation</span><span class="p">(</span><span class="k">array</span><span class="p">(</span> <span class="s1">&#39;from-path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;*&#39;</span> <span class="p">));</span> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p><em>The asterisk assigned to <code>from-path</code> tells <code>perch_pages_navigation</code> to work from the current directory (&lsquo;projects&rsquo;).</em></p>

<p><em>More information on <code>perch_pages_navigation</code> can be found here, <a href="http://docs.grabaperch.com/docs/navigation/perch-pages-navigation/">perch_pages_navigation</a>.</em></p>

<p>Would output:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ul&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/projects/project-1.php&quot;</span><span class="nt">&gt;</span>Project 1<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/projects/project-2.php&quot;</span><span class="nt">&gt;</span>Project 2<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/li&gt;</span>
</span><span class='line'><span class="nt">&lt;/ul&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>perch_pages_navigation</code> function uses the HTML template &lsquo;perch/templates/navigation/item.html&rsquo; to generate the HTML above. This is a file that can be modified, or even replaced using the <code>template</code> option.</p>

<p>You&rsquo;re restricted in the content that can be displayed in this template. This is because of how data in Perch is grouped. Within a <code>perch_pages_navigation</code> template, you have access to data related to the page, like the title and path. But you don&rsquo;t have access to content regions, defined using <code>perch_content</code>, as this not information that is shared across all pages.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>Page Content
</span><span class='line'>  - pagePath <span class="nt">&lt;--</span> <span class="na">Can</span> <span class="na">access</span> <span class="na">this</span>
</span><span class='line'>  <span class="na">Region</span> <span class="na">Content</span> <span class="err">(</span><span class="na">as</span> <span class="na">defined</span> <span class="na">in</span> <span class="na">a</span> <span class="na">perch_content</span> <span class="na">region</span><span class="err">)</span>
</span><span class='line'>      <span class="na">-</span> <span class="na">some_content</span> <span class="err">&lt;</span><span class="na">--</span> <span class="na">Can</span><span class="err">&#39;</span><span class="na">t</span> <span class="na">access</span> <span class="na">this</span>
</span></code></pre></td></tr></table></div></figure>


<p>As of Perch 2.4, you can extend the amount content saved at a page level, using <a href="/blog/2015/02/18/page-attributes-in-perch/">Page Attributes</a>. Page Attributes can be very useful, but they can&rsquo;t be used to be target a sub-sect of pages (like our project pages), so are not ideal for what we&rsquo;re trying to achieve. I.E You can only add fields that will be available to all pages.</p>

<p><em>Update: This is not entirely true. You can set an &lsquo;Attribute template&rsquo; per page, in &lsquo;Page Options&rsquo;. Attribute templates allow you to decide which attributes are configurable at a page level. There is a draw back back though; the &lsquo;Attribute template&rsquo; is not saved in a Master page. So it would be down to the user to configure the &lsquo;Attribute template&rsquo; each page. Checkout my post of Page Attributes <a href="/blog/2015/02/18/page-attributes-in-perch/">here</a>.</em></p>

<p>What is needed is a mechanism, whereby the page order is retrieved from the Navigation part of Perch and the content, from a region designed with our projects in mind.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>      <span class="nv">$nav</span> <span class="o">=</span> <span class="nx">perch_pages_navigation</span><span class="p">(</span><span class="k">array</span><span class="p">(</span> <span class="c1">// Return navigation pages data as array</span>
</span><span class='line'>          <span class="s1">&#39;from-path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;skip-template&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
</span><span class='line'>          <span class="p">));</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">foreach</span><span class="p">(</span><span class="nv">$nav</span> <span class="k">as</span> <span class="nv">$page</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Loop through &amp; customise each item returned in the array</span>
</span><span class='line'>          <span class="nx">PerchSystem</span><span class="o">::</span><span class="na">set_var</span><span class="p">(</span><span class="s1">&#39;pageNavText&#39;</span><span class="p">,</span> <span class="nv">$page</span><span class="p">[</span><span class="s1">&#39;pageNavText&#39;</span><span class="p">]);</span> <span class="c1">// Grab the page title</span>
</span><span class='line'>          <span class="nx">PerchSystem</span><span class="o">::</span><span class="na">set_var</span><span class="p">(</span><span class="s1">&#39;pagePath&#39;</span><span class="p">,</span> <span class="nv">$page</span><span class="p">[</span><span class="s1">&#39;pagePath&#39;</span><span class="p">]);</span> <span class="c1">// Find the correct links for each page</span>
</span><span class='line'>          <span class="nx">perch_content_custom</span><span class="p">(</span><span class="s1">&#39;Detail&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span> <span class="c1">// &#39;Detail&#39; is the region containing the data we need - this is used in the target page template</span>
</span><span class='line'>              <span class="s1">&#39;page&#39;</span> <span class="o">=&gt;</span> <span class="nv">$page</span><span class="p">[</span><span class="s1">&#39;pagePath&#39;</span><span class="p">],</span> <span class="c1">// The dynamic path to the page which contains the target region</span>
</span><span class='line'>              <span class="s1">&#39;template&#39;</span> <span class="o">=&gt;</span><span class="s1">&#39;project_item.html&#39;</span> <span class="c1">// This region reuses data from target pages (image, excerpt)</span>
</span><span class='line'>          <span class="p">));</span>
</span><span class='line'>
</span><span class='line'>          <span class="nv">$i</span> <span class="o">=</span> <span class="nv">$i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;/ul&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The PHP above retrieves our list of pages using <code>perch_pages_navigation</code>, but this time skipping the template. Setting <code>skip-template</code> to <code>true</code>, bypasses the HTML rendering process and returns an array instead. The array itself is a list of all our project pages, including associated page data.</p>

<p>With the array in hand, we can apply it to a standard content region, allowing us to access project specific content. Within the <code>foreach</code> loop, we grab what we need from the page data (in this case <code>pagePath</code> and <code>pageNavText</code>). We&rsquo;ll need the <code>pagePath</code> value for two reasons; we&rsquo;ll need to know where we&rsquo;re linking too, but also we can use <code>pagePath</code> to summon up our project specific content.</p>

<p>See this line below, it&rsquo;s instructing <code>perch_content_custom</code> to go to the project page for the content to populate our template (&lsquo;project_item.html&rsquo;).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="s1">&#39;page&#39;</span> <span class="o">=&gt;</span> <span class="nv">$page</span><span class="p">[</span><span class="s1">&#39;pagePath&#39;</span><span class="p">],</span> <span class="c1">// The dynamic path to the page which contains the target region</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s really powerful, but I&rsquo;ve skipped two things:</p>

<ol>
<li>What does the &lsquo;Detail&rsquo; region of the project page look like?</li>
<li>What does &lsquo;project_item.html&rsquo; look like?</li>
</ol>


<p>Where possible I tend to organise my page templates into as few content regions as possible, the primary region typically being called &lsquo;Detail&rsquo;.</p>

<p>Let&rsquo;s assume we&rsquo;re project title is being inferred from the page title. Below is the Detail region (&lsquo;project_detail.html&rsquo;), which includes a description, an image and a list of features.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;desc&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;perch:content</span> <span class="na">id=</span><span class="s">&quot;desc&quot;</span> <span class="na">type=</span><span class="s">&quot;textarea&quot;</span> <span class="na">label=</span><span class="s">&quot;Description&quot;</span> <span class="na">html=</span><span class="s">&quot;true&quot;</span> <span class="na">editor=</span><span class="s">&quot;ckeditor&quot;</span> <span class="na">imagewidth=</span><span class="s">&quot;640&quot;</span> <span class="na">imageheight=</span><span class="s">&quot;480&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;two-col&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;image&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;&lt;perch:content type=&quot;</span><span class="na">image</span><span class="err">&quot;</span> <span class="na">id=</span><span class="s">&quot;image&quot;</span> <span class="na">label=</span><span class="s">&quot;Image&quot;</span> <span class="na">width=</span><span class="s">&quot;800&quot;</span> <span class="nt">/&gt;</span>&quot; alt=&quot;<span class="nt">&lt;perch:content</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;alt&quot;</span> <span class="na">label=</span><span class="s">&quot;Description&quot;</span> <span class="na">required=</span><span class="s">&quot;true&quot;</span> <span class="na">help=</span><span class="s">&quot;e.g. Photo of MD John Smith with his best wig on&quot;</span> <span class="na">title=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>&quot; /&gt;
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;feat&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>          <span class="nt">&lt;perch:repeater</span> <span class="na">id=</span><span class="s">&quot;features&quot;</span> <span class="na">label=</span><span class="s">&quot;Features&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>              <span class="nt">&lt;li&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;perch:content</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;feature&quot;</span> <span class="na">label=</span><span class="s">&quot;Feature&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/perch:repeater&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>Since the inclusion of <a href="http://docs.grabaperch.com/docs/templates/repeaters/">Repeaters</a> within content templates, it&rsquo;s become much easier to create self contained content regions. Before repeaters, the moment you hit an image gallery or feature list, you&rsquo;d need to duck out of your primary content region and create a new repeating content region. Leading to fun naming conventions like &lsquo;Detail - Top&rsquo; and &lsquo;Detail - Bottom&rsquo;, with &lsquo;Feature List&rsquo; stuck in the middle.</em></p>

<p>We&rsquo;ll need to some an additional fields to &lsquo;project_detail.html&rsquo;,for us to access in the index page, a thumbnail and an excerpt:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;perch:content</span> <span class="na">id=</span><span class="s">&quot;thumbnail&quot;</span> <span class="na">type=</span><span class="s">&quot;image&quot;</span> <span class="na">label=</span><span class="s">&quot;Thumbnail&quot;</span> <span class="na">width=</span><span class="s">&quot;310&quot;</span> <span class="na">height=</span><span class="s">&quot;160&quot;</span> <span class="na">crop=</span><span class="s">&quot;true&quot;</span> <span class="na">required=</span><span class="s">&quot;true&quot;</span> <span class="na">help=</span><span class="s">&quot;Recommended image size: 310px wide &amp; 160px high&quot;</span> <span class="na">suppress=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;perch:content</span> <span class="na">id=</span><span class="s">&quot;excerpt&quot;</span> <span class="na">type=</span><span class="s">&quot;textarea&quot;</span> <span class="na">label=</span><span class="s">&quot;Excerpt&quot;</span> <span class="na">html=</span><span class="s">&quot;false&quot;</span> <span class="na">imagewidth=</span><span class="s">&quot;640&quot;</span> <span class="na">imageheight=</span><span class="s">&quot;480&quot;</span> <span class="na">suppress=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Both fields have <code>suppress</code> set to <code>true</code>, meaning that they fields available for input, but will not appear in the resulting HTML for the template. We want the use to be able to enter an excerpt, but we don&rsquo;t want the except to appear on the detail page.</p>

<p>So, what does &lsquo;project_item.html&rsquo; look like? You can see it below:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;article&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h2&gt;</span>
</span><span class='line'>      <span class="nt">&lt;perch:content</span> <span class="na">id=</span><span class="s">&quot;pageNavText&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;project-thumb&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;&lt;perch:content id=&quot;</span><span class="na">thumbnail</span><span class="err">&quot;</span> <span class="na">type=</span><span class="s">&quot;image&quot;</span> <span class="na">width=</span><span class="s">&quot;310&quot;</span> <span class="na">height=</span><span class="s">&quot;160&quot;</span> <span class="na">crop=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>&quot; alt=&quot;&quot; class=&quot;img-responsive&quot; /&gt;
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;project-detail&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;excerpt&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;p&gt;</span>
</span><span class='line'>              <span class="nt">&lt;perch:content</span> <span class="na">id=</span><span class="s">&quot;excerpt&quot;</span> <span class="na">type=</span><span class="s">&quot;textarea&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>          
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&lt;perch:content id=&quot;</span><span class="na">pagePath</span><span class="err">&quot;</span> <span class="nt">/&gt;</span>&quot;&gt;
</span><span class='line'>          VIEW CASE STUDY
</span><span class='line'>      <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/article&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The title is inferred from the <code>pageNavText</code> variable (set in the <code>foreach</code> loop), likewise the url comes from <code>pagePath</code>. The thumbnail and the except are retrieved using standard Perch content tags, as it is after all content being rendered using <code>perch_content_custom</code>.</p>

<p>Your resulting index page will look something like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;article&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h2&gt;</span>
</span><span class='line'>      Project 1
</span><span class='line'>  <span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;project-thumb&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;/images/project-1.jpg&quot;</span> <span class="na">alt=</span><span class="s">&quot;&quot;</span> <span class="na">class=</span><span class="s">&quot;img-responsive&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;project-detail&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;excerpt&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;p&gt;</span>
</span><span class='line'>              Project excerpt
</span><span class='line'>          <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>          
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/projects/project-1.php&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          VIEW CASE STUDY
</span><span class='line'>      <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/article&gt;</span>
</span><span class='line'><span class="nt">&lt;article&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h2&gt;</span>
</span><span class='line'>      Project 2
</span><span class='line'>  <span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;project-thumb&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;/images/project-2.jpg&quot;</span> <span class="na">alt=</span><span class="s">&quot;&quot;</span> <span class="na">class=</span><span class="s">&quot;img-responsive&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;project-detail&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;excerpt&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;p&gt;</span>
</span><span class='line'>              Project 2 excerpt
</span><span class='line'>          <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>          
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/projects/project-2.php&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          VIEW CASE STUDY
</span><span class='line'>      <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/article&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see above, we now have an index page with links to the sub pages, including a brief excerpt and a thumbnail for each.</p>

<p>The advantages of this solution are:</p>

<ol>
<li>Because the solution uses  <code>perch_pages_navigation</code>, the page will honour Perch&rsquo;s ordering functionality.</li>
<li>The use of <code>perch_content_custom</code> means that we can create fields specifically for use in project pages, that don&rsquo;t bloat the page data of non project pages.</li>
</ol>


<p>The problem with the solution, is that multiple calls to the database are required to display the list. One to retrieve the navigation list, and then an additional call for each of the pages returned.</p>

<p>A solution that reduced the amount of database calls, while still harnessed the power of the Perch templating system, might to write a SQL statement manually, the joined the navigation <code>SELECT</code> statement to a statement retrieving the desired content data, then parsed each of the results through the templating system. This might be something I investigate, should the volume of sub pages, demonstrate a noticeable slowdown of load time.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Richard Kimber</span></span>

      




<time class='entry-date' datetime='2015-01-14T23:14:12+00:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:14 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/perch/'>perch</a>, <a class='category' href='/blog/categories/php/'>php</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://rich.k3r.me/blog/2015/01/14/flexible-index-pages-in-perch/" data-via="kim3er" data-counturl="http://rich.k3r.me/blog/2015/01/14/flexible-index-pages-in-perch/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/01/13/the-funniest-men-of-all-time-rebuttal/" title="Previous Post: The funniest men of all time - Rebuttal">&laquo; The funniest men of all time - Rebuttal</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/01/20/finding-a-pair-of-headphones/" title="Next Post: Finding a pair of headphones">Finding a pair of headphones &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/04/21/there-is-no-spoon/">There Is No Spoon</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/12/consuming-es6-modules-in-npm-packages/">Consuming ES6 Modules in NPM Packages</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/02/controlling-cordova-from-gulp/">Controlling Cordova From Gulp</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/23/in-the-name-of-gulp/">In the Name of Gulp</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/05/comics-the-drm-effect/">Comics: The DRM Effect</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/kim3er">@kim3er</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'kim3er',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/RichardKimber?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Richard Kimber -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'k3r';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://rich.k3r.me/blog/2015/01/14/flexible-index-pages-in-perch/';
        var disqus_url = 'http://rich.k3r.me/blog/2015/01/14/flexible-index-pages-in-perch/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
